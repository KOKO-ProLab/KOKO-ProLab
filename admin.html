<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fule Online - ÙÙŠÙˆÙ„ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-card: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --accent-primary: #2563eb;
            --accent-hover: #1d4ed8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #242424;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --border-color: #404040;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.3s, color 0.3s;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .balance-display {
            background: var(--bg-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Added notification bell styles */
        .notification-bell {
            position: relative;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .notification-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 16px var(--shadow);
            width: 320px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            margin-top: 10px;
        }

        .notification-dropdown.active {
            display: block;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }

        .notification-item:hover {
            background: var(--bg-secondary);
        }

        .notification-item.unread {
            background: rgba(37, 99, 235, 0.05);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .notification-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Added floating contact buttons */
        .floating-contacts {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 999;
        }

        .contact-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
        }

        .contact-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .contact-btn.whatsapp {
            background: #25D366;
        }

        .contact-btn.telegram {
            background: #0088cc;
        }

        .contact-btn.livechat {
            background: var(--accent-primary);
        }

        .contact-btn svg {
            width: 28px;
            height: 28px;
            fill: white;
        }

        /* Added live chat widget */
        .livechat-widget {
            position: fixed;
            bottom: 100px;
            left: 20px;
            width: 350px;
            height: 500px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            display: none;
            flex-direction: column;
            z-index: 998;
        }

        .livechat-widget.active {
            display: flex;
        }

        .livechat-header {
            background: var(--accent-primary);
            color: white;
            padding: 15px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .livechat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 12px;
            word-wrap: break-word;
        }

        .chat-message.user {
            align-self: flex-end;
            background: var(--accent-primary);
            color: white;
        }

        .chat-message.support {
            align-self: flex-start;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .livechat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            gap: 10px;
        }

        .livechat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .nav-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-icon {
            padding: 8px;
            background: transparent;
            border: 1px solid var(--border-color);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* Main Content */
        main {
            padding: 30px 0;
            min-height: calc(100vh - 200px);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Auth Forms */
        .auth-container {
            max-width: 450px;
            margin: 50px auto;
            background: var(--bg-card);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 16px var(--shadow);
        }

        .auth-title {
            font-size: 28px;
            margin-bottom: 30px;
            text-align: center;
            color: var(--accent-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 25px;
        }

        .form-link {
            text-align: center;
            color: var(--accent-primary);
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .floating-contacts {
                left: 10px;
                bottom: 10px;
            }
            
            .livechat-widget {
                left: 10px;
                right: 10px;
                width: auto;
                bottom: 90px;
            }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--shadow);
        }

        .card-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .card-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .card-price {
            font-size: 20px;
            font-weight: bold;
            color: var(--accent-primary);
            margin-bottom: 15px;
        }

        /* Added offer badge */
        .card-offer {
            background: var(--danger);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 10px;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Added category header */
        .category-header {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .category-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-primary);
            margin-bottom: 8px;
        }

        .category-description {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 600;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 500px;
            width: 90%;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 4px 16px var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-right: 4px solid var(--success);
        }

        .toast.error {
            border-right: 4px solid var(--danger);
        }

        .toast.warning {
            border-right: 4px solid var(--warning);
        }

        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
        }

        tr:hover {
            background: var(--bg-secondary);
        }

        /* Status Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-processing {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-approved {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Footer */
        footer {
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            padding: 30px 0;
            margin-top: 50px;
        }

        .footer-content {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 30px;
        }

        .footer-stat {
            text-align: center;
        }

        .footer-stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .footer-stat-label {
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Admin Panel */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 10px 20px;
            background: var(--bg-secondary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-primary);
        }

        .admin-tab.active {
            background: var(--accent-primary);
            color: white;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .currency-selector {
            display: flex;
            gap: 5px;
        }

        .currency-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-primary);
        }

        .currency-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .hidden {
            display: none !important;
        }

        /* Added ticket styles */
        .ticket-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .ticket-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--shadow);
        }

        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .ticket-id {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .ticket-subject {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .ticket-preview {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .ticket-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .ticket-messages {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .ticket-message {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .ticket-message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .ticket-message-sender {
            font-weight: 600;
            color: var(--text-primary);
        }

        .ticket-message-body {
            color: var(--text-primary);
            line-height: 1.5;
        }

        /* Added custom fields management */
        .field-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .field-info {
            flex: 1;
        }

        .field-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .field-details {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .field-actions {
            display: flex;
            gap: 8px;
        }
        
        /* <!-- CHANGE: Enhanced form styling with better visual hierarchy and UX --> */
        .auth-container {
            max-width: 420px;
            margin: 60px auto;
            padding: 40px;
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .auth-title {
            text-align: center;
            margin-bottom: 32px;
            font-size: 28px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 24px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            padding-right: 45px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-input.error {
            border-color: #ef4444;
        }

        .form-input.success {
            border-color: #10b981;
        }

        .input-icon {
            position: absolute;
            right: 16px;
            color: var(--text-secondary);
            pointer-events: none;
        }

        .password-toggle {
            position: absolute;
            left: 16px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s;
            pointer-events: all;
        }

        .password-toggle:hover {
            color: var(--primary-color);
        }

        .form-error {
            display: none;
            margin-top: 6px;
            font-size: 13px;
            color: #ef4444;
        }

        .form-error.show {
            display: block;
        }

        .password-strength {
            margin-top: 8px;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
            display: none;
        }

        .password-strength.show {
            display: block;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .password-strength-text {
            margin-top: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            display: none;
        }

        .password-strength-text.show {
            display: block;
        }

        .form-actions {
            margin-top: 28px;
        }

        .btn-auth {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .btn-auth:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-auth .spinner {
            display: none;
            width: 18px;
            height: 18px;
            border: 2px solid #ffffff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin: 0 auto;
        }

        .btn-auth.loading .spinner {
            display: block;
        }

        .btn-auth.loading .btn-text {
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .form-link {
            text-align: center;
            margin-top: 24px;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.2s;
        }

        .form-link:hover {
            opacity: 0.8;
            text-decoration: underline;
        }

        .form-divider {
            display: flex;
            align-items: center;
            margin: 24px 0;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-divider::before,
        .form-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-color);
        }

        .form-divider::before {
            margin-left: 12px;
        }

        .form-divider::after {
            margin-right: 12px;
        }
    </style>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>

     Header 
    <header id="mainHeader" class="hidden">
        <div class="container">
            <div class="header-content">
                <div class="logo">ÙÙŠÙˆÙ„ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div>
                <div class="header-actions">
                    <div class="balance-display">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"/></svg>
                        <span id="balanceDisplay">0</span>
                        <span id="currencySymbol">EGP</span>
                    </div>
                    <div class="currency-selector">
                        <button class="currency-btn active" data-currency="EGP">EGP</button>
                        <button class="currency-btn" data-currency="USD">USD</button>
                        <button class="currency-btn" data-currency="EUR">EUR</button>
                    </div>
                     Added notification bell 
                    <div class="notification-bell" id="notificationBell">
                        <button class="btn btn-icon">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
                        </button>
                        <span class="notification-badge hidden" id="notificationBadge">0</span>
                        <div class="notification-dropdown" id="notificationDropdown">
                            <div id="notificationList"></div>
                        </div>
                    </div>
                    <div class="nav-links">
                        <button class="btn btn-secondary" onclick="showSection('products')">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
                        <button class="btn btn-secondary" onclick="showSection('offers')">Ø§Ù„Ø¹Ø±ÙˆØ¶</button>
                        <button class="btn btn-secondary" onclick="showSection('orders')">Ø·Ù„Ø¨Ø§ØªÙŠ</button>
                        <button class="btn btn-secondary" onclick="showSection('deposits')">Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</button>
                        <button class="btn btn-secondary" onclick="showSection('tickets')">Ø§Ù„ØªØ°Ø§ÙƒØ±</button>
                        <button class="btn btn-secondary" onclick="showSection('profile')">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
                        <button class="btn btn-secondary" id="adminBtn" onclick="showSection('admin')" style="display: none;">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
                    </div>
                    <button class="btn btn-icon" id="themeToggle">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
                    </button>
                    <button class="btn btn-danger" id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>
    </header>

     Added floating contact buttons 
    <div class="floating-contacts">
        <button class="contact-btn whatsapp" id="whatsappBtn" title="ÙˆØ§ØªØ³Ø§Ø¨">
            <svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
        </button>
        <button class="contact-btn telegram" id="telegramBtn" title="ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…">
            <svg viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
        </button>
        <button class="contact-btn livechat" id="livechatBtn" title="Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©">
            <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
        </button>
    </div>

     Added live chat widget 
    <div class="livechat-widget" id="livechatWidget">
        <div class="livechat-header">
            <div>
                <div style="font-weight: 600;">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</div>
                <div style="font-size: 12px; opacity: 0.9;">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</div>
            </div>
            <button class="btn btn-icon" id="closeLivechat" style="color: white; border-color: rgba(255,255,255,0.3);">Ã—</button>
        </div>
        <div class="livechat-messages" id="livechatMessages">
            <div class="chat-message support">
                Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ
            </div>
        </div>
        <div class="livechat-input">
            <input type="text" id="livechatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
            <button class="btn btn-primary" id="sendLivechatBtn">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

    <main>
         Login Section 
        <div class="section active" id="loginSection">
            <div class="auth-container">
                <h2 class="auth-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <div class="form-input-wrapper">
                            <input type="email" class="form-input" id="loginEmail" placeholder="example@domain.com" required>
                            <span class="input-icon">ğŸ“§</span>
                        </div>
                        <div class="form-error" id="loginEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <div class="form-input-wrapper">
                            <input type="password" class="form-input" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                            <span class="input-icon">ğŸ”’</span>
                            <span class="password-toggle" onclick="togglePassword('loginPassword')">ğŸ‘ï¸</span>
                        </div>
                        <div class="form-error" id="loginPasswordError"></div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-auth">
                            <span class="btn-text">Ø¯Ø®ÙˆÙ„</span>
                            <div class="spinner"></div>
                        </button>
                    </div>
                </form>
                <div class="form-link" onclick="showSection('register')">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</div>
            </div>
        </div>

         Register Section 
        <div class="section" id="registerSection">
            <div class="auth-container">
                <h2 class="auth-title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡)</label>
                        <div class="form-input-wrapper">
                            <input type="text" class="form-input" id="registerUsername" placeholder="username" required minlength="3" maxlength="20">
                            <span class="input-icon">ğŸ‘¤</span>
                        </div>
                        <div class="form-error" id="registerUsernameError"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <div class="form-input-wrapper">
                            <input type="text" class="form-input" id="registerDisplayName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
                            <span class="input-icon">âœï¸</span>
                        </div>
                        <div class="form-error" id="registerDisplayNameError"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <div class="form-input-wrapper">
                            <input type="email" class="form-input" id="registerEmail" placeholder="example@domain.com" required>
                            <span class="input-icon">ğŸ“§</span>
                        </div>
                        <div class="form-error" id="registerEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <div class="form-input-wrapper">
                            <input type="password" class="form-input" id="registerPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="6">
                            <span class="input-icon">ğŸ”’</span>
                            <span class="password-toggle" onclick="togglePassword('registerPassword')">ğŸ‘ï¸</span>
                        </div>
                        <div class="password-strength" id="passwordStrength">
                            <div class="password-strength-bar" id="passwordStrengthBar"></div>
                        </div>
                        <div class="password-strength-text" id="passwordStrengthText"></div>
                        <div class="form-error" id="registerPasswordError"></div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-auth">
                            <span class="btn-text">ØªØ³Ø¬ÙŠÙ„</span>
                            <div class="spinner"></div>
                        </button>
                    </div>
                </form>
                <div class="form-link" onclick="showSection('login')">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
            </div>
        </div>

         Products Section 
        <div class="section" id="productsSection">
            <div class="container">
                <h2 style="font-size: 28px; margin-bottom: 20px;">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
                <div id="productsContainer"></div>
            </div>
        </div>

         Added Offers Section 
        <div class="section" id="offersSection">
            <div class="container">
                <h2 style="font-size: 28px; margin-bottom: 20px;">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©</h2>
                <div id="offersContainer"></div>
            </div>
        </div>

         Orders Section 
        <div class="section" id="ordersSection">
            <div class="container">
                <h2 style="font-size: 28px; margin-bottom: 20px;">Ø·Ù„Ø¨Ø§ØªÙŠ</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <tr><td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

         Deposits Section 
        <div class="section" id="depositsSection">
            <div class="container">
                <h2 style="font-size: 28px; margin-bottom: 20px;">Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</h2>
                <div class="card" style="max-width: 600px; margin: 0 auto;">
                    <h3 class="card-title">Ø·Ù„Ø¨ Ø¥ÙŠØ¯Ø§Ø¹ Ø¬Ø¯ÙŠØ¯</h3>
                    <form id="depositForm">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº (EGP)</label>
                            <input type="number" class="form-input" id="depositAmount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                            <select class="form-input" id="depositMethod" required>
                                <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
                                <option value="crypto">Ø¹Ù…Ù„Ø§Øª Ø±Ù‚Ù…ÙŠØ© (Ø¹Ø§Ù„Ù…ÙŠ)</option>
                                <option value="vodafone">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ (Ù…ØµØ±)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</label>
                            <textarea class="form-input" id="depositDetails" rows="3" placeholder="Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ (Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©ØŒ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©ØŒ Ø¥Ù„Ø®)" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</button>
                    </form>
                </div>
                <h3 style="margin-top: 40px; margin-bottom: 20px;">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            </tr>
                        </thead>
                        <tbody id="depositsTableBody">
                            <tr><td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¥ÙŠØ¯Ø§Ø¹</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

         Added Tickets Section 
        <div class="section" id="ticketsSection">
            <div class="container">
                <h2 style="font-size: 28px; margin-bottom: 20px;">Ø§Ù„ØªØ°Ø§ÙƒØ±</h2>
                <button class="btn btn-primary" onclick="openModal('newTicketModal')" style="margin-bottom: 20px;">ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <div id="ticketsContainer"></div>
            </div>
        </div>

         Profile Section 
        <div class="section" id="profileSection">
            <div class="container">
                <h2 style="font-size: 28px; margin-bottom: 20px;">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
                <div class="card" style="max-width: 600px; margin: 0 auto;">
                    <form id="profileForm">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡)</label>
                            <input type="text" class="form-input" id="profileUsername" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                            <input type="text" class="form-input" id="profileDisplayName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" class="form-input" id="profileEmail" disabled>
                        </div>
                        <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                    </form>
                </div>
            </div>
        </div>

         Admin Section 
        <div class="section" id="adminSection">
            <div class="container">
                <h2 style="font-size: 28px; margin-bottom: 20px;">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="showAdminTab('adminProducts')">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
                    <button class="admin-tab" onclick="showAdminTab('adminCategories')">Ø§Ù„ÙØ¦Ø§Øª</button>
                    <button class="admin-tab" onclick="showAdminTab('adminFields')">Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØ©</button>
                    <button class="admin-tab" onclick="showAdminTab('adminOrders')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                    <button class="admin-tab" onclick="showAdminTab('adminDeposits')">Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</button>
                    <button class="admin-tab" onclick="showAdminTab('adminTickets')">Ø§Ù„ØªØ°Ø§ÙƒØ±</button>
                    <button class="admin-tab" onclick="showAdminTab('adminUsers')">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</button>
                    <button class="admin-tab" onclick="showAdminTab('adminSettings')">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                    <button class="admin-tab" onclick="showAdminTab('adminStats')">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                </div>

                 Admin Products 
                <div class="admin-section active" id="adminProducts">
                    <button class="btn btn-primary" onclick="openModal('productModal')" style="margin-bottom: 20px;">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</button>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                                    <th>Ø§Ù„ÙØ¦Ø©</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ù…Ø±Ø¦ÙŠ</th>
                                    <th>Ø¹Ø±Ø¶</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="adminProductsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                 Added Admin Categories 
                <div class="admin-section" id="adminCategories">
                    <button class="btn btn-primary" onclick="openModal('categoryModal')" style="margin-bottom: 20px;">Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                                    <th>Ø§Ù„ÙˆØµÙ</th>
                                    <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="adminCategoriesTableBody"></tbody>
                        </table>
                    </div>
                </div>

                 Added Admin Custom Fields 
                <div class="admin-section" id="adminFields">
                    <button class="btn btn-primary" onclick="openModal('fieldModal')" style="margin-bottom: 20px;">Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù…Ø®ØµØµ</button>
                    <div id="adminFieldsContainer"></div>
                </div>

                 Admin Orders 
                <div class="admin-section" id="adminOrders">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="adminOrdersTableBody"></tbody>
                        </table>
                    </div>
                </div>

                 Added Admin Deposits 
                <div class="admin-section" id="adminDeposits">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th>
                                    <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="adminDepositsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                 Added Admin Tickets 
                <div class="admin-section" id="adminTickets">
                    <div id="adminTicketsContainer"></div>
                </div>

                 Admin Users 
                <div class="admin-section" id="adminUsers">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ù…Ø¹Ø±Ù</th>
                                    <th>Ø§Ù„Ø¯ÙˆØ±</th>
                                    <th>Ù…ÙˆØ«Ù‚</th>
                                    <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTableBody"></tbody>
                        </table>
                    </div>
                </div>

                 Admin Settings 
                <div class="admin-section" id="adminSettings">
                    <div class="card" style="max-width: 800px;">
                        <h3 class="card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                        <form id="settingsForm">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                                <input type="text" class="form-input" id="settingSiteTitle">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                                <textarea class="form-input" id="settingSiteDescription" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø©)</label>
                                <input type="text" class="form-input" id="settingWhatsapp" placeholder="201234567890">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…</label>
                                <input type="text" class="form-input" id="settingTelegram" placeholder="@username">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø³Ø¹Ø± ØµØ±Ù USD Ø¥Ù„Ù‰ EGP</label>
                                <input type="number" class="form-input" id="settingUsdToEgp" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø³Ø¹Ø± ØµØ±Ù EUR Ø¥Ù„Ù‰ EGP</label>
                                <input type="number" class="form-input" id="settingEurToEgp" step="0.01">
                            </div>
                            <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </form>
                    </div>
                </div>

                 Admin Stats 
                <div class="admin-section" id="adminStats">
                    <div class="card" style="max-width: 800px;">
                        <h3 class="card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
                        <form id="statsForm">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</label>
                                <input type="number" class="form-input" id="statActiveUsers">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</label>
                                <input type="number" class="form-input" id="statTotalOrders">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</label>
                                <input type="number" class="form-input" id="statDailyOrders">
                            </div>
                            <button type="submit" class="btn btn-primary">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

     Footer 
    <footer id="mainFooter" class="hidden">
        <div class="container">
            <div class="footer-content">
                <div class="footer-stat">
                    <div class="footer-stat-value" id="footerActiveUsers">33,000</div>
                    <div class="footer-stat-label">Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø´Ø·</div>
                </div>
                <div class="footer-stat">
                    <div class="footer-stat-value" id="footerTotalOrders">125,000</div>
                    <div class="footer-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                </div>
                <div class="footer-stat">
                    <div class="footer-stat-value" id="footerDailyOrders">450</div>
                    <div class="footer-stat-label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
            </div>
        </div>
    </footer>

     Product Modal 
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" id="closeProductModal">Ã—</button>
            </div>
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ÙØ¦Ø©</label>
                    <select class="form-input" id="productCategory" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <input type="text" class="form-input" id="productName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                    <textarea class="form-input" id="productDescription" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø³Ø¹Ø± (EGP)</label>
                    <input type="number" class="form-input" id="productPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="url" class="form-input" id="productImage" placeholder="https://example.com/image.jpg">
                    <div class="form-hint">Ø§ØªØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <select class="form-input" id="productType" required>
                        <option value="digital">Ø±Ù‚Ù…ÙŠ</option>
                        <option value="physical">Ù…Ø§Ø¯ÙŠ</option>
                        <option value="smm">Ø®Ø¯Ù…Ø© SMM</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="productVisible"> Ù…Ø±Ø¦ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="productOffer"> Ø¹Ø±Ø¶ Ø®Ø§Øµ
                    </label>
                </div>
                <div class="form-group" id="offerDiscountGroup" style="display: none;">
                    <label class="form-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (%)</label>
                    <input type="number" class="form-input" id="productOfferDiscount" min="0" max="100">
                </div>
                <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
            </form>
        </div>
    </div>

     Added Category Modal 
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="categoryModalTitle">Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button class="modal-close" id="closeCategoryModal">Ã—</button>
            </div>
            <form id="categoryForm">
                <input type="hidden" id="categoryId">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©</label>
                    <input type="text" class="form-input" id="categoryName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                    <textarea class="form-input" id="categoryDescription" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ØªØ±ØªÙŠØ¨</label>
                    <input type="number" class="form-input" id="categoryOrder" value="0">
                </div>
                <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ÙØ¦Ø©</button>
            </form>
        </div>
    </div>

     Added Custom Field Modal 
    <div class="modal" id="fieldModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù…Ø®ØµØµ</h3>
                <button class="modal-close" id="closeFieldModal">Ã—</button>
            </div>
            <form id="fieldForm">
                <input type="hidden" id="fieldId">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„</label>
                    <input type="text" class="form-input" id="fieldName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†Øµ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (Hint)</label>
                    <input type="text" class="form-input" id="fieldHint" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø­Ø³Ø§Ø¨Ùƒ">
                </div>
                <div class="form-group">
                    <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ù‚Ù„</label>
                    <select class="form-input" id="fieldType" required>
                        <option value="text">Ù†Øµ</option>
                        <option value="number">Ø±Ù‚Ù…</option>
                        <option value="url">Ø±Ø§Ø¨Ø·</option>
                        <option value="textarea">Ù†Øµ Ø·ÙˆÙŠÙ„</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ÙŠÙ†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <select class="form-input" id="fieldProductType" required>
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</option>
                        <option value="digital">Ø±Ù‚Ù…ÙŠ</option>
                        <option value="physical">Ù…Ø§Ø¯ÙŠ</option>
                        <option value="smm">Ø®Ø¯Ù…Ø© SMM</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="fieldRequired"> Ø­Ù‚Ù„ Ø¥Ù„Ø²Ø§Ù…ÙŠ
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ø­Ù‚Ù„</button>
            </form>
        </div>
    </div>

     Order Modal 
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</h3>
                <button class="modal-close" id="closeOrderModal">Ã—</button>
            </div>
            <form id="orderForm">
                <input type="hidden" id="orderProductId">
                <input type="hidden" id="orderProductType">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <input type="text" class="form-input" id="orderProductName" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø³Ø¹Ø±</label>
                    <input type="text" class="form-input" id="orderProductPrice" disabled>
                </div>
                <div id="customFieldsContainer"></div>
                <div class="form-group">
                    <label class="form-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select class="form-input" id="orderPaymentMethod" required>
                        <option value="balance">Ø§Ù„Ø±ØµÙŠØ¯</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
            </form>
        </div>
    </div>

     Order Status Modal 
    <div class="modal" id="orderStatusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
                <button class="modal-close" id="closeOrderStatusModal">Ã—</button>
            </div>
            <form id="orderStatusForm">
                <input type="hidden" id="statusOrderId">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <select class="form-input" id="orderStatus" required>
                        <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                        <option value="processing">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                        <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                        <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</button>
            </form>
        </div>
    </div>

     User Edit Modal 
    <div class="modal" id="userEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                <button class="modal-close" id="closeUserEditModal">Ã—</button>
            </div>
            <form id="userEditForm">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø±ØµÙŠØ¯ (EGP)</label>
                    <input type="number" class="form-input" id="editUserBalance" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø¯ÙˆØ±</label>
                    <select class="form-input" id="editUserRole">
                        <option value="user">Ù…Ø³ØªØ®Ø¯Ù…</option>
                        <option value="admin">Ù…Ø¯ÙŠØ±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="editUserVerified"> Ù…ÙˆØ«Ù‚
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </form>
        </div>
    </div>

     Added New Ticket Modal 
    <div class="modal" id="newTicketModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button class="modal-close" id="closeNewTicketModal">Ã—</button>
            </div>
            <form id="newTicketForm">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label>
                    <input type="text" class="form-input" id="ticketSubject" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                    <textarea class="form-input" id="ticketMessage" rows="5" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                    <select class="form-input" id="ticketPriority" required>
                        <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                        <option value="medium">Ù…ØªÙˆØ³Ø·Ø©</option>
                        <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒØ±Ø©</button>
            </form>
        </div>
    </div>

     Added Ticket View Modal 
    <div class="modal" id="ticketViewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="ticketViewTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ°ÙƒØ±Ø©</h3>
                <button class="modal-close" id="closeTicketViewModal">Ã—</button>
            </div>
            <div id="ticketViewContent"></div>
            <div class="ticket-messages" id="ticketViewMessages"></div>
            <form id="ticketReplyForm">
                <input type="hidden" id="replyTicketId">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø±Ø¯</label>
                    <textarea class="form-input" id="ticketReply" rows="3" required></textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>
                    <button type="button" class="btn btn-success" id="closeTicketBtn">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ°ÙƒØ±Ø©</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDoc, getDocs, query, where, onSnapshot, setDoc, serverTimestamp, orderBy, increment } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
        import { getDatabase, ref, set, get, onValue, increment as rtdbIncrement } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCcxGOaiiy6Dy1MybOIOxn69xab4rsOOJ0",
            authDomain: "koko-caffe.firebaseapp.com",
            databaseURL: "https://koko-caffe-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "koko-caffe",
            storageBucket: "koko-caffe.firebasestorage.app",
            messagingSenderId: "382318796715",
            appId: "1:382318796715:web:ee9f3aca9a107f86da7cee",
            measurementId: "G-B83G77QPWW"
        };

        let app, auth, db, rtdb;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            rtdb = getDatabase(app);
            console.log('[v0] Firebase initialized successfully');
        } catch (error) {
            console.error('[v0] Firebase initialization error:', error);
            showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase', 'error');
        }

        let currentUser = null;
        let currentCurrency = 'EGP';
        let exchangeRates = { USD: 30.5, EUR: 33.2 };
        let unsubscribers = [];
        let categories = [];
        let customFields = [];
        let siteSettings = {};

        // Utility Functions
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(`${sectionName}Section`).classList.add('active');
            
            if (sectionName === 'products') loadProducts();
            if (sectionName === 'offers') loadOffers();
            if (sectionName === 'orders') loadOrders();
            if (sectionName === 'deposits') loadUserDeposits();
            if (sectionName === 'tickets') loadTickets();
            if (sectionName === 'profile') loadProfile();
            if (sectionName === 'admin') {
                loadAdminProducts();
                loadAdminCategories();
                loadAdminFields();
                loadAdminOrders();
                loadAdminDeposits();
                loadAdminTickets();
                loadAdminUsers();
                loadAdminSettings();
                loadAdminStats();
            }
        }

        function showAdminTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        window.showSection = showSection;
        window.showAdminTab = showAdminTab;

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        window.openModal = openModal;
        window.closeModal = closeModal;

        function formatPrice(price) {
            if (currentCurrency === 'EGP') return `${price.toFixed(2)} EGP`;
            if (currentCurrency === 'USD') return `$${(price / exchangeRates.USD).toFixed(2)}`;
            if (currentCurrency === 'EUR') return `â‚¬${(price / exchangeRates.EUR).toFixed(2)}`;
        }

        function convertToEGP(price) {
            if (currentCurrency === 'EGP') return price;
            if (currentCurrency === 'USD') return price * exchangeRates.USD;
            if (currentCurrency === 'EUR') return price * exchangeRates.EUR;
        }

        async function addNotification(userId, title, message, type = 'info') {
            try {
                await addDoc(collection(db, 'notifications'), {
                    userId,
                    title,
                    message,
                    read: false,
                    createdAt: serverTimestamp()
                });
            } catch (error) {
                console.error('[v0] Add notification error:', error);
            }
        }

        function loadNotifications() {
            if (!currentUser) return;
            
            const q = query(
                collection(db, 'notifications'),
                where('userId', '==', currentUser.uid),
                orderBy('createdAt', 'desc')
            );
            
            const unsub = onSnapshot(q, (snapshot) => {
                const notificationList = document.getElementById('notificationList');
                const badge = document.getElementById('notificationBadge');
                
                if (snapshot.empty) {
                    notificationList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>';
                    badge.classList.add('hidden');
                    return;
                }
                
                const unreadCount = snapshot.docs.filter(doc => !doc.data().read).length;
                if (unreadCount > 0) {
                    badge.textContent = unreadCount;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
                
                notificationList.innerHTML = '';
                snapshot.docs.forEach(notifDoc => {
                    const notif = notifDoc.data();
                    const div = document.createElement('div');
                    div.className = `notification-item ${!notif.read ? 'unread' : ''}`;
                    div.innerHTML = `
                        <div class="notification-title">${notif.title}</div>
                        <div class="notification-text">${notif.message}</div>
                        <div class="notification-time">${notif.createdAt ? new Date(notif.createdAt.toDate()).toLocaleString('ar-EG') : 'Ø§Ù„Ø¢Ù†'}</div>
                    `;
                    div.onclick = async () => {
                        if (!notif.read) {
                            await updateDoc(doc(db, 'notifications', notifDoc.id), { read: true });
                        }
                    };
                    notificationList.appendChild(div);
                });
            });
            
            unsubscribers.push(unsub);
        }

        document.getElementById('notificationBell').addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('notificationDropdown').classList.toggle('active');
        });

        document.addEventListener('click', () => {
            document.getElementById('notificationDropdown').classList.remove('active');
        });

        document.getElementById('whatsappBtn').addEventListener('click', () => {
            const phone = siteSettings.whatsapp || '201234567890';
            window.open(`https://wa.me/${phone}`, '_blank');
        });

        document.getElementById('telegramBtn').addEventListener('click', () => {
            const username = siteSettings.telegram || 'fule_online';
            window.open(`https://t.me/${username}`, '_blank');
        });

        document.getElementById('livechatBtn').addEventListener('click', () => {
            document.getElementById('livechatWidget').classList.add('active');
        });

        document.getElementById('closeLivechat').addEventListener('click', () => {
            document.getElementById('livechatWidget').classList.remove('active');
        });

        document.getElementById('sendLivechatBtn').addEventListener('click', async () => {
            const input = document.getElementById('livechatInput');
            const message = input.value.trim();
            if (!message) return;
            
            const messagesContainer = document.getElementById('livechatMessages');
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user';
            userMsg.textContent = message;
            messagesContainer.appendChild(userMsg);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            input.value = '';
            
            // Save to Firestore
            try {
                await addDoc(collection(db, 'livechat'), {
                    userId: currentUser.uid,
                    username: currentUser.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…',
                    message,
                    sender: 'user',
                    createdAt: serverTimestamp()
                });
            } catch (error) {
                console.error('[v0] Send livechat error:', error);
            }
        });

        document.getElementById('livechatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('sendLivechatBtn').click();
            }
        });

        // Load live chat messages
        function loadLivechat() {
            if (!currentUser) return;
            
            const q = query(
                collection(db, 'livechat'),
                where('userId', '==', currentUser.uid),
                orderBy('createdAt', 'asc')
            );
            
            const unsub = onSnapshot(q, (snapshot) => {
                const messagesContainer = document.getElementById('livechatMessages');
                messagesContainer.innerHTML = '<div class="chat-message support">Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>';
                
                snapshot.docs.forEach(msgDoc => {
                    const msg = msgDoc.data();
                    const div = document.createElement('div');
                    div.className = `chat-message ${msg.sender}`;
                    div.textContent = msg.message;
                    messagesContainer.appendChild(div);
                });
                
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            });
            
            unsubscribers.push(unsub);
        }

        // Authentication
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value.trim().toLowerCase();
            const displayName = document.getElementById('registerDisplayName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const submitBtn = e.target.querySelector('.btn-auth');
            
            // Validate inputs
            let isValid = true;
            
            if (!username || username.length < 3) {
                validateInput('registerUsername', 'registerUsernameError', () => false, 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                isValid = false;
            } else if (!/^[a-z0-9_]+$/.test(username)) {
                validateInput('registerUsername', 'registerUsernameError', () => false, 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·');
                isValid = false;
            }
            
            if (!displayName) {
                validateInput('registerDisplayName', 'registerDisplayNameError', () => false, 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø·Ù„ÙˆØ¨');
                isValid = false;
            }
            
            if (!email) {
                validateInput('registerEmail', 'registerEmailError', () => false, 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨');
                isValid = false;
            }
            
            if (!password || password.length < 6) {
                validateInput('registerPassword', 'registerPasswordError', () => false, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            
            try {
                console.log('[v0] Checking username availability...');
                
                // Check if username exists
                const usernameQuery = query(collection(db, 'users'), where('username', '==', username));
                const usernameSnapshot = await getDocs(usernameQuery);
                
                if (!usernameSnapshot.empty) {
                    validateInput('registerUsername', 'registerUsernameError', () => false, 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('loading');
                    return;
                }
                
                console.log('[v0] Creating user account...');
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                console.log('[v0] Creating user document...');
                await setDoc(doc(db, 'users', user.uid), {
                    username: username,
                    displayName: displayName,
                    email: email,
                    role: 'user',
                    balance: 0,
                    verified: false,
                    createdAt: new Date().toISOString()
                });
                
                console.log('[v0] Registration successful');
                showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                showSection('products');
            } catch (error) {
                console.error('[v0] Registration error:', error);
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„';
                        validateInput('registerEmail', 'registerEmailError', () => false, errorMessage);
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­';
                        validateInput('registerEmail', 'registerEmailError', () => false, errorMessage);
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ø·Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹';
                        validateInput('registerPassword', 'registerPasswordError', () => false, errorMessage);
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
                        break;
                }
                
                showToast(errorMessage, 'error');
            } finally {
                // Hide loading state
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            }
        });

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const submitBtn = e.target.querySelector('.btn-auth');
            
            // Validate inputs
            let isValid = true;
            
            if (!email) {
                validateInput('loginEmail', 'loginEmailError', () => false, 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨');
                isValid = false;
            }
            
            if (!password) {
                validateInput('loginPassword', 'loginPasswordError', () => false, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            
            try {
                console.log('[v0] Attempting login...');
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('[v0] Login successful:', userCredential.user.uid);
                showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                showSection('products');
            } catch (error) {
                console.error('[v0] Login error:', error);
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­';
                        validateInput('loginEmail', 'loginEmailError', () => false, errorMessage);
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„';
                        validateInput('loginEmail', 'loginEmailError', () => false, errorMessage);
                        break;
                    case 'auth/wrong-password':
                    case 'auth/invalid-credential':
                        errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                        validateInput('loginPassword', 'loginPasswordError', () => false, errorMessage);
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ØªÙ… ØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
                        break;
                }
                
                showToast(errorMessage, 'error');
            } finally {
                // Hide loading state
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            }
        });

        onAuthStateChanged(auth, async (user) => {
            console.log('[v0] Auth state changed:', user ? user.uid : 'logged out');
            
            if (user) {
                try {
                    currentUser = user;
                    console.log('[v0] Loading user data...');
                    
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    
                    if (!userDoc.exists()) {
                        console.error('[v0] User document not found');
                        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                        await signOut(auth);
                        return;
                    }
                    
                    const userData = userDoc.data();
                    console.log('[v0] User data loaded:', userData.username);
                    
                    document.getElementById('mainHeader').classList.remove('hidden');
                    document.getElementById('mainFooter').classList.remove('hidden');
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    document.getElementById('productsSection').classList.add('active');
                    
                    if (userData.role === 'admin') {
                        document.getElementById('adminBtn').style.display = 'inline-flex';
                        console.log('[v0] Admin access granted');
                    }
                    
                    loadBalance();
                    loadProducts();
                    loadOffers();
                    loadOrders();
                    loadStats();
                    loadNotifications();
                    loadLivechat();
                    loadCategories();
                    loadCustomFields();
                    loadSiteSettings();
                    
                    console.log('[v0] All data loaded successfully');
                } catch (error) {
                    console.error('[v0] Error loading user data:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                }
            } else {
                currentUser = null;
                document.getElementById('mainHeader').classList.add('hidden');
                document.getElementById('mainFooter').classList.add('hidden');
                document.getElementById('adminBtn').style.display = 'none';
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById('loginSection').classList.add('active');
                console.log('[v0] User logged out, showing login screen');
            }
        });

        // Load Balance
        function loadBalance() {
            if (!currentUser) return;
            const balanceRef = ref(rtdb, `balances/${currentUser.uid}`);
            const unsub = onValue(balanceRef, (snapshot) => {
                const data = snapshot.val();
                const balance = data?.balance || 0;
                document.getElementById('balanceDisplay').textContent = formatPrice(balance);
            });
            unsubscribers.push(unsub);
        }

        // Currency Selector
        document.querySelectorAll('.currency-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCurrency = btn.dataset.currency;
                document.getElementById('currencySymbol').textContent = currentCurrency;
                loadBalance();
                loadProducts();
                loadOffers();
            });
        });

        // Theme Toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            html.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
        });

        async function loadSiteSettings() {
            try {
                const settingsDoc = await getDoc(doc(db, 'settings', 'site'));
                if (settingsDoc.exists()) {
                    siteSettings = settingsDoc.data();
                    exchangeRates.USD = siteSettings.currencies?.USD || 30.5;
                    exchangeRates.EUR = siteSettings.currencies?.EUR || 33.2;
                }
            } catch (error) {
                console.error('[v0] Load site settings error:', error);
            }
        }

        async function loadCategories() {
            try {
                const q = query(collection(db, 'categories'), orderBy('order', 'asc'));
                const snapshot = await getDocs(q);
                categories = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error('[v0] Load categories error:', error);
            }
        }

        async function loadCustomFields() {
            try {
                const snapshot = await getDocs(collection(db, 'customFields'));
                customFields = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (error) {
                console.error('[v0] Load custom fields error:', error);
            }
        }

        async function loadProducts() {
            try {
                const q = query(collection(db, 'products'), where('visible', '==', true), where('isOffer', '==', false));
                const snapshot = await getDocs(q);
                const container = document.getElementById('productsContainer');
                container.innerHTML = '';
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø©</p>';
                    return;
                }
                
                // Group products by category
                const productsByCategory = {};
                snapshot.docs.forEach(productDoc => {
                    const product = { id: productDoc.id, ...productDoc.data() };
                    const categoryId = product.category || 'uncategorized';
                    if (!productsByCategory[categoryId]) {
                        productsByCategory[categoryId] = [];
                    }
                    productsByCategory[categoryId].push(product);
                });
                
                // Render categories and products
                categories.forEach(category => {
                    const products = productsByCategory[category.id];
                    if (!products || products.length === 0) return;
                    
                    const categoryDiv = document.createElement('div');
                    categoryDiv.innerHTML = `
                        <div class="category-header">
                            <div class="category-title">${category.name}</div>
                            <div class="category-description">${category.description || ''}</div>
                        </div>
                        <div class="grid" id="category-${category.id}"></div>
                    `;
                    container.appendChild(categoryDiv);
                    
                    const grid = document.getElementById(`category-${category.id}`);
                    products.forEach(product => {
                        const card = createProductCard(product);
                        grid.appendChild(card);
                    });
                });
                
                // Render uncategorized products
                const uncategorized = productsByCategory['uncategorized'];
                if (uncategorized && uncategorized.length > 0) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.innerHTML = `
                        <div class="category-header">
                            <div class="category-title">Ù…Ù†ØªØ¬Ø§Øª Ø£Ø®Ø±Ù‰</div>
                        </div>
                        <div class="grid" id="category-uncategorized"></div>
                    `;
                    container.appendChild(categoryDiv);
                    
                    const grid = document.getElementById('category-uncategorized');
                    uncategorized.forEach(product => {
                        const card = createProductCard(product);
                        grid.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('[v0] Load products error:', error);
            }
        }

        async function loadOffers() {
            try {
                const q = query(collection(db, 'products'), where('visible', '==', true), where('isOffer', '==', true));
                const snapshot = await getDocs(q);
                const container = document.getElementById('offersContainer');
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                    return;
                }
                
                const grid = document.createElement('div');
                grid.className = 'grid';
                snapshot.docs.forEach(productDoc => {
                    const product = { id: productDoc.id, ...productDoc.data() };
                    const card = createProductCard(product, true);
                    grid.appendChild(card);
                });
                container.innerHTML = '';
                container.appendChild(grid);
            } catch (error) {
                console.error('[v0] Load offers error:', error);
            }
        }

        function createProductCard(product, showOffer = false) {
            const card = document.createElement('div');
            card.className = 'card';
            
            const originalPrice = product.price;
            const discountedPrice = product.offerDiscount ? originalPrice * (1 - product.offerDiscount / 100) : originalPrice;
            
            card.innerHTML = `
                ${product.image ? `<img src="${product.image}" alt="${product.name}" class="card-image" onerror="this.src='/placeholder.svg?height=180&width=300'">` : `<img src="/placeholder.svg?height=180&width=300" alt="${product.name}" class="card-image">`}
                ${showOffer && product.offerDiscount ? `<div class="card-offer">Ø®ØµÙ… ${product.offerDiscount}%</div>` : ''}
                <div class="card-title">${product.name}</div>
                <div class="card-description">${product.description}</div>
                ${product.offerDiscount ? `
                    <div style="text-decoration: line-through; color: var(--text-secondary); font-size: 14px;">${formatPrice(originalPrice)}</div>
                    <div class="card-price">${formatPrice(discountedPrice)}</div>
                ` : `<div class="card-price">${formatPrice(originalPrice)}</div>`}
                <button class="btn btn-primary" onclick="window.openOrderModal('${product.id}', '${product.name}', ${discountedPrice}, '${product.type}')">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
            `;
            return card;
        }

        window.openOrderModal = async (productId, productName, productPrice, productType) => {
            // Check for pending orders
            try {
                const q = query(
                    collection(db, 'orders'),
                    where('userId', '==', currentUser.uid),
                    where('productId', '==', productId),
                    where('status', 'in', ['pending', 'processing'])
                );
                const snapshot = await getDocs(q);
                if (!snapshot.empty) {
                    showToast('Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
                    return;
                }
            } catch (error) {
                console.error('[v0] Check pending orders error:', error);
            }
            
            document.getElementById('orderProductId').value = productId;
            document.getElementById('orderProductName').value = productName;
            document.getElementById('orderProductPrice').value = formatPrice(productPrice);
            document.getElementById('orderProductType').value = productType;
            
            const container = document.getElementById('customFieldsContainer');
            container.innerHTML = '';
            
            const applicableFields = customFields.filter(field => 
                field.productType === 'all' || field.productType === productType
            );
            
            applicableFields.forEach(field => {
                const div = document.createElement('div');
                div.className = 'form-group';
                
                let inputHtml = '';
                if (field.type === 'textarea') {
                    inputHtml = `<textarea class="form-input" id="field-${field.id}" ${field.required ? 'required' : ''}></textarea>`;
                } else {
                    inputHtml = `<input type="${field.type}" class="form-input" id="field-${field.id}" ${field.required ? 'required' : ''}>`;
                }
                
                div.innerHTML = `
                    <label class="form-label">${field.name}</label>
                    ${inputHtml}
                    ${field.hint ? `<div class="form-hint">${field.hint}</div>` : ''}
                `;
                container.appendChild(div);
            });
            
            openModal('orderModal');
        };

        document.getElementById('closeOrderModal').addEventListener('click', () => closeModal('orderModal'));

        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productId = document.getElementById('orderProductId').value;
            const productName = document.getElementById('orderProductName').value;
            const productPrice = convertToEGP(parseFloat(document.getElementById('orderProductPrice').value.replace(/[^0-9.]/g, '')));
            const productType = document.getElementById('orderProductType').value;
            const paymentMethod = document.getElementById('orderPaymentMethod').value;

            try {
                const balanceSnap = await get(ref(rtdb, `balances/${currentUser.uid}`));
                const balance = balanceSnap.val()?.balance || 0;

                if (balance < productPrice) {
                    showToast('Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ', 'error');
                    return;
                }

                // Collect custom field values
                const customFieldValues = {};
                customFields.forEach(field => {
                    const input = document.getElementById(`field-${field.id}`);
                    if (input) {
                        customFieldValues[field.name] = input.value;
                    }
                });

                const orderId = `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                await addDoc(collection(db, 'orders'), {
                    orderId,
                    userId: currentUser.uid,
                    productId,
                    productName,
                    price: productPrice,
                    productType,
                    paymentMethod,
                    customFields: customFieldValues,
                    status: 'pending',
                    createdAt: serverTimestamp()
                });

                await set(ref(rtdb, `balances/${currentUser.uid}`), {
                    balance: balance - productPrice
                });

                await set(ref(rtdb, 'stats/global/totalOrders'), rtdbIncrement(1));
                await set(ref(rtdb, 'stats/global/dailyOrders'), rtdbIncrement(1));

                closeModal('orderModal');
                showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                loadOrders();
            } catch (error) {
                console.error('[v0] Create order error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨', 'error');
            }
        });

        // Load Orders
        function loadOrders() {
            if (!currentUser) return;
            
            const q = query(
                collection(db, 'orders'),
                where('userId', '==', currentUser.uid),
                orderBy('createdAt', 'desc')
            );
            
            const unsub = onSnapshot(q, (snapshot) => {
                const tbody = document.getElementById('ordersTableBody');
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>';
                    return;
                }

                tbody.innerHTML = '';
                snapshot.docs.forEach(orderDoc => {
                    const order = orderDoc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.orderId}</td>
                        <td>${order.productName}</td>
                        <td>${formatPrice(order.price)}</td>
                        <td><span class="badge badge-${order.status}">${getStatusText(order.status)}</span></td>
                        <td>${order.createdAt ? new Date(order.createdAt.toDate()).toLocaleDateString('ar-EG') : '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
            });
            
            unsubscribers.push(unsub);
        }

        function getStatusText(status) {
            const statusMap = {
                pending: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                processing: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
                completed: 'Ù…ÙƒØªÙ…Ù„',
                cancelled: 'Ù…Ù„ØºÙŠ'
            };
            return statusMap[status] || status;
        }

        // Deposits
        document.getElementById('depositForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const method = document.getElementById('depositMethod').value;
            const details = document.getElementById('depositDetails').value.trim();

            try {
                await addDoc(collection(db, 'deposits'), {
                    userId: currentUser.uid,
                    amount,
                    method,
                    details,
                    status: 'pending',
                    createdAt: serverTimestamp()
                });

                document.getElementById('depositForm').reset();
                showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹');
                loadUserDeposits();
            } catch (error) {
                console.error('[v0] Create deposit error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹', 'error');
            }
        });

        function loadUserDeposits() {
            if (!currentUser) return;
            
            const q = query(
                collection(db, 'deposits'),
                where('userId', '==', currentUser.uid),
                orderBy('createdAt', 'desc')
            );
            
            const unsub = onSnapshot(q, (snapshot) => {
                const tbody = document.getElementById('depositsTableBody');
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¥ÙŠØ¯Ø§Ø¹</td></tr>';
                    return;
                }

                tbody.innerHTML = '';
                snapshot.docs.forEach(depositDoc => {
                    const deposit = depositDoc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatPrice(deposit.amount)}</td>
                        <td>${deposit.method === 'crypto' ? 'Ø¹Ù…Ù„Ø§Øª Ø±Ù‚Ù…ÙŠØ©' : 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´'}</td>
                        <td><span class="badge badge-${deposit.status}">${getDepositStatusText(deposit.status)}</span></td>
                        <td>${deposit.createdAt ? new Date(deposit.createdAt.toDate()).toLocaleDateString('ar-EG') : '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
            });
            
            unsubscribers.push(unsub);
        }

        function getDepositStatusText(status) {
            const statusMap = {
                pending: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                approved: 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡',
                rejected: 'Ù…Ø±ÙÙˆØ¶'
            };
            return statusMap[status] || status;
        }

        document.getElementById('closeNewTicketModal').addEventListener('click', () => closeModal('newTicketModal'));
        document.getElementById('closeTicketViewModal').addEventListener('click', () => closeModal('ticketViewModal'));

        document.getElementById('newTicketForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const subject = document.getElementById('ticketSubject').value.trim();
            const message = document.getElementById('ticketMessage').value.trim();
            const priority = document.getElementById('ticketPriority').value;

            try {
                const ticketId = `TKT-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                const ticketRef = await addDoc(collection(db, 'tickets'), {
                    ticketId,
                    userId: currentUser.uid,
                    username: currentUser.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…',
                    subject,
                    priority,
                    status: 'open',
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                });

                await addDoc(collection(db, 'ticketMessages'), {
                    ticketId: ticketRef.id,
                    userId: currentUser.uid,
                    username: currentUser.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…',
                    message,
                    sender: 'user',
                    createdAt: serverTimestamp()
                });

                document.getElementById('newTicketForm').reset();
                closeModal('newTicketModal');
                showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­');
                loadTickets();
            } catch (error) {
                console.error('[v0] Create ticket error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ°ÙƒØ±Ø©', 'error');
            }
        });

        function loadTickets() {
            if (!currentUser) return;
            
            const q = query(
                collection(db, 'tickets'),
                where('userId', '==', currentUser.uid),
                orderBy('updatedAt', 'desc')
            );
            
            const unsub = onSnapshot(q, (snapshot) => {
                const container = document.getElementById('ticketsContainer');
                if (snapshot.empty) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ±</p>';
                    return;
                }

                container.innerHTML = '';
                snapshot.docs.forEach(ticketDoc => {
                    const ticket = { id: ticketDoc.id, ...ticketDoc.data() };
                    const card = document.createElement('div');
                    card.className = 'ticket-card';
                    card.innerHTML = `
                        <div class="ticket-header">
                            <span class="ticket-id">${ticket.ticketId}</span>
                            <span class="badge badge-${ticket.status}">${getTicketStatusText(ticket.status)}</span>
                        </div>
                        <div class="ticket-subject">${ticket.subject}</div>
                        <div class="ticket-meta">
                            <span>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ${getPriorityText(ticket.priority)}</span>
                            <span>${ticket.createdAt ? new Date(ticket.createdAt.toDate()).toLocaleDateString('ar-EG') : '-'}</span>
                        </div>
                    `;
                    card.onclick = () => viewTicket(ticket.id);
                    container.appendChild(card);
                });
            });
            
            unsubscribers.push(unsub);
        }

        function getTicketStatusText(status) {
            const statusMap = {
                open: 'Ù…ÙØªÙˆØ­Ø©',
                closed: 'Ù…ØºÙ„Ù‚Ø©'
            };
            return statusMap[status] || status;
        }

        function getPriorityText(priority) {
            const priorityMap = {
                low: 'Ù…Ù†Ø®ÙØ¶Ø©',
                medium: 'Ù…ØªÙˆØ³Ø·Ø©',
                high: 'Ø¹Ø§Ù„ÙŠØ©'
            };
            return priorityMap[priority] || priority;
        }

        async function viewTicket(ticketId) {
            try {
                const ticketDoc = await getDoc(doc(db, 'tickets', ticketId));
                const ticket = ticketDoc.data();
                
                document.getElementById('ticketViewTitle').textContent = `ØªØ°ÙƒØ±Ø©: ${ticket.ticketId}`;
                document.getElementById('ticketViewContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">${ticket.subject}</div>
                        <div style="display: flex; gap: 15px; font-size: 13px; color: var(--text-secondary);">
                            <span>Ø§Ù„Ø­Ø§Ù„Ø©: <span class="badge badge-${ticket.status}">${getTicketStatusText(ticket.status)}</span></span>
                            <span>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ${getPriorityText(ticket.priority)}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('replyTicketId').value = ticketId;
                
                // Load messages
                const q = query(
                    collection(db, 'ticketMessages'),
                    where('ticketId', '==', ticketId),
                    orderBy('createdAt', 'asc')
                );
                const messagesSnap = await getDocs(q);
                const messagesContainer = document.getElementById('ticketViewMessages');
                messagesContainer.innerHTML = '';
                
                messagesSnap.docs.forEach(msgDoc => {
                    const msg = msgDoc.data();
                    const div = document.createElement('div');
                    div.className = 'ticket-message';
                    div.innerHTML = `
                        <div class="ticket-message-header">
                            <span class="ticket-message-sender">${msg.sender === 'user' ? msg.username : 'Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ'}</span>
                            <span>${msg.createdAt ? new Date(msg.createdAt.toDate()).toLocaleString('ar-EG') : '-'}</span>
                        </div>
                        <div class="ticket-message-body">${msg.message}</div>
                    `;
                    messagesContainer.appendChild(div);
                });
                
                openModal('ticketViewModal');
            } catch (error) {
                console.error('[v0] View ticket error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªØ°ÙƒØ±Ø©', 'error');
            }
        }

        window.viewTicket = viewTicket;

        document.getElementById('ticketReplyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const ticketId = document.getElementById('replyTicketId').value;
            const reply = document.getElementById('ticketReply').value.trim();

            try {
                await addDoc(collection(db, 'ticketMessages'), {
                    ticketId,
                    userId: currentUser.uid,
                    username: currentUser.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…',
                    message: reply,
                    sender: 'user',
                    createdAt: serverTimestamp()
                });

                await updateDoc(doc(db, 'tickets', ticketId), {
                    updatedAt: serverTimestamp()
                });

                document.getElementById('ticketReply').value = '';
                showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯');
                viewTicket(ticketId);
            } catch (error) {
                console.error('[v0] Reply ticket error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯', 'error');
            }
        });

        document.getElementById('closeTicketBtn').addEventListener('click', async () => {
            const ticketId = document.getElementById('replyTicketId').value;
            try {
                await updateDoc(doc(db, 'tickets', ticketId), {
                    status: 'closed',
                    updatedAt: serverTimestamp()
                });
                closeModal('ticketViewModal');
                showToast('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ°ÙƒØ±Ø©');
            } catch (error) {
                console.error('[v0] Close ticket error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ°ÙƒØ±Ø©', 'error');
            }
        });

        // Profile
        function loadProfile() {
            if (!currentUser) return;
            
            getDoc(doc(db, 'users', currentUser.uid)).then(userDoc => {
                const user = userDoc.data();
                document.getElementById('profileUsername').value = user.username;
                document.getElementById('profileDisplayName').value = user.displayName;
                document.getElementById('profileEmail').value = user.email;
            });
        }

        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const displayName = document.getElementById('profileDisplayName').value.trim();

            try {
                await updateDoc(doc(db, 'users', currentUser.uid), { displayName });
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
            } catch (error) {
                console.error('[v0] Update profile error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ', 'error');
            }
        });

        // Admin Functions
        document.getElementById('closeProductModal').addEventListener('click', () => closeModal('productModal'));
        document.getElementById('closeCategoryModal').addEventListener('click', () => closeModal('categoryModal'));
        document.getElementById('closeFieldModal').addEventListener('click', () => closeModal('fieldModal'));
        document.getElementById('closeOrderStatusModal').addEventListener('click', () => closeModal('orderStatusModal'));
        document.getElementById('closeUserEditModal').addEventListener('click', () => closeModal('userEditModal'));

        document.getElementById('productOffer').addEventListener('change', (e) => {
            document.getElementById('offerDiscountGroup').style.display = e.target.checked ? 'block' : 'none';
        });

        async function loadAdminCategories() {
            try {
                const q = query(collection(db, 'categories'), orderBy('order', 'asc'));
                const unsub = onSnapshot(q, (snapshot) => {
                    const tbody = document.getElementById('adminCategoriesTableBody');
                    const select = document.getElementById('productCategory');
                    
                    if (snapshot.empty) {
                        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª</td></tr>';
                        select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>';
                        return;
                    }

                    tbody.innerHTML = '';
                    select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>';
                    
                    snapshot.docs.forEach(catDoc => {
                        const category = catDoc.data();
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${category.name}</td>
                            <td>${category.description || '-'}</td>
                            <td>${category.order}</td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="window.editCategory('${catDoc.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                                <button class="btn btn-danger btn-sm" onclick="window.deleteCategory('${catDoc.id}')">Ø­Ø°Ù</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                        
                        const option = document.createElement('option');
                        option.value = catDoc.id;
                        option.textContent = category.name;
                        select.appendChild(option);
                    });
                });
                
                unsubscribers.push(unsub);
            } catch (error) {
                console.error('[v0] Load admin categories error:', error);
            }
        }

        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const categoryId = document.getElementById('categoryId').value;
            const name = document.getElementById('categoryName').value.trim();
            const description = document.getElementById('categoryDescription').value.trim();
            const order = parseInt(document.getElementById('categoryOrder').value);

            try {
                const categoryData = { name, description, order };
                
                if (categoryId) {
                    await updateDoc(doc(db, 'categories', categoryId), categoryData);
                    showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø©');
                } else {
                    await addDoc(collection(db, 'categories'), categoryData);
                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø©');
                }

                document.getElementById('categoryForm').reset();
                document.getElementById('categoryId').value = '';
                closeModal('categoryModal');
                loadCategories();
            } catch (error) {
                console.error('[v0] Save category error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙØ¦Ø©', 'error');
            }
        });

        window.editCategory = async (categoryId) => {
            try {
                const catDoc = await getDoc(doc(db, 'categories', categoryId));
                const category = catDoc.data();
                
                document.getElementById('categoryId').value = categoryId;
                document.getElementById('categoryName').value = category.name;
                document.getElementById('categoryDescription').value = category.description || '';
                document.getElementById('categoryOrder').value = category.order;
                document.getElementById('categoryModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ¦Ø©';
                
                openModal('categoryModal');
            } catch (error) {
                console.error('[v0] Edit category error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø©', 'error');
            }
        };

        window.deleteCategory = async (categoryId) => {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©ØŸ')) return;
            
            try {
                await deleteDoc(doc(db, 'categories', categoryId));
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©');
                loadCategories();
            } catch (error) {
                console.error('[v0] Delete category error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©', 'error');
            }
        };

        async function loadAdminFields() {
            try {
                const unsub = onSnapshot(collection(db, 'customFields'), (snapshot) => {
                    const container = document.getElementById('adminFieldsContainer');
                    
                    if (snapshot.empty) {
                        container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù‚ÙˆÙ„ Ù…Ø®ØµØµØ©</p>';
                        return;
                    }

                    container.innerHTML = '';
                    snapshot.docs.forEach(fieldDoc => {
                        const field = fieldDoc.data();
                        const div = document.createElement('div');
                        div.className = 'field-item';
                        div.innerHTML = `
                            <div class="field-info">
                                <div class="field-name">${field.name}</div>
                                <div class="field-details">
                                    Ø§Ù„Ù†ÙˆØ¹: ${getFieldTypeText(field.type)} | 
                                    ÙŠÙ†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰: ${getProductTypeText(field.productType)} | 
                                    ${field.required ? 'Ø¥Ù„Ø²Ø§Ù…ÙŠ' : 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ'}
                                    ${field.hint ? ` | ${field.hint}` : ''}
                                </div>
                            </div>
                            <div class="field-actions">
                                <button class="btn btn-secondary btn-sm" onclick="window.editField('${fieldDoc.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                                <button class="btn btn-danger btn-sm" onclick="window.deleteField('${fieldDoc.id}')">Ø­Ø°Ù</button>
                            </div>
                        `;
                        container.appendChild(div);
                    });
                });
                
                unsubscribers.push(unsub);
            } catch (error) {
                console.error('[v0] Load admin fields error:', error);
            }
        }

        function getFieldTypeText(type) {
            const typeMap = {
                text: 'Ù†Øµ',
                number: 'Ø±Ù‚Ù…',
                url: 'Ø±Ø§Ø¨Ø·',
                textarea: 'Ù†Øµ Ø·ÙˆÙŠÙ„'
            };
            return typeMap[type] || type;
        }

        function getProductTypeText(type) {
            const typeMap = {
                all: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
                digital: 'Ø±Ù‚Ù…ÙŠ',
                physical: 'Ù…Ø§Ø¯ÙŠ',
                smm: 'Ø®Ø¯Ù…Ø© SMM'
            };
            return typeMap[type] || type;
        }

        document.getElementById('fieldForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fieldId = document.getElementById('fieldId').value;
            const name = document.getElementById('fieldName').value.trim();
            const hint = document.getElementById('fieldHint').value.trim();
            const type = document.getElementById('fieldType').value;
            const productType = document.getElementById('fieldProductType').value;
            const required = document.getElementById('fieldRequired').checked;

            try {
                const fieldData = { name, hint, type, productType, required };
                
                if (fieldId) {
                    await updateDoc(doc(db, 'customFields', fieldId), fieldData);
                    showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚Ù„');
                } else {
                    await addDoc(collection(db, 'customFields'), fieldData);
                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚Ù„');
                }

                document.getElementById('fieldForm').reset();
                document.getElementById('fieldId').value = '';
                closeModal('fieldModal');
                loadCustomFields();
            } catch (error) {
                console.error('[v0] Save field error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø­Ù‚Ù„', 'error');
            }
        });

        window.editField = async (fieldId) => {
            try {
                const fieldDoc = await getDoc(doc(db, 'customFields', fieldId));
                const field = fieldDoc.data();
                
                document.getElementById('fieldId').value = fieldId;
                document.getElementById('fieldName').value = field.name;
                document.getElementById('fieldHint').value = field.hint || '';
                document.getElementById('fieldType').value = field.type;
                document.getElementById('fieldProductType').value = field.productType;
                document.getElementById('fieldRequired').checked = field.required;
                
                openModal('fieldModal');
            } catch (error) {
                console.error('[v0] Edit field error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù‚Ù„', 'error');
            }
        };

        window.deleteField = async (fieldId) => {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ØŸ')) return;
            
            try {
                await deleteDoc(doc(db, 'customFields', fieldId));
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ù‚Ù„');
                loadCustomFields();
            } catch (error) {
                console.error('[v0] Delete field error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ù‚Ù„', 'error');
            }
        };

        // Admin Products
        async function loadAdminProducts() {
            try {
                const unsub = onSnapshot(collection(db, 'products'), (snapshot) => {
                    const tbody = document.getElementById('adminProductsTableBody');
                    if (snapshot.empty) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>';
                        return;
                    }

                    tbody.innerHTML = '';
                    snapshot.docs.forEach(productDoc => {
                        const product = productDoc.data();
                        const category = categories.find(c => c.id === product.category);
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${product.name}</td>
                            <td>${category ? category.name : '-'}</td>
                            <td>${formatPrice(product.price)}</td>
                            <td>${product.type}</td>
                            <td>${product.visible ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</td>
                            <td>${product.isOffer ? `Ù†Ø¹Ù… (${product.offerDiscount}%)` : 'Ù„Ø§'}</td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="window.editProduct('${productDoc.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                                <button class="btn btn-danger btn-sm" onclick="window.deleteProduct('${productDoc.id}')">Ø­Ø°Ù</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                });
                unsubscribers.push(unsub);
            } catch (error) {
                console.error('[v0] Load admin products error:', error);
            }
        }

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productId = document.getElementById('productId').value;
            const category = document.getElementById('productCategory').value;
            const name = document.getElementById('productName').value.trim();
            const description = document.getElementById('productDescription').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const image = document.getElementById('productImage').value.trim();
            const type = document.getElementById('productType').value;
            const visible = document.getElementById('productVisible').checked;
            const isOffer = document.getElementById('productOffer').checked;
            const offerDiscount = isOffer ? parseFloat(document.getElementById('productOfferDiscount').value) : 0;

            try {
                const productData = {
                    category,
                    name,
                    description,
                    price,
                    image: image || '',
                    type,
                    visible,
                    isOffer,
                    offerDiscount
                };

                if (productId) {
                    await updateDoc(doc(db, 'products', productId), productData);
                    showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬');
                } else {
                    await addDoc(collection(db, 'products'), productData);
                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬');
                }

                document.getElementById('productForm').reset();
                document.getElementById('productId').value = '';
                document.getElementById('offerDiscountGroup').style.display = 'none';
                closeModal('productModal');
            } catch (error) {
                console.error('[v0] Save product error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬', 'error');
            }
        });

        window.editProduct = async (productId) => {
            try {
                const productDoc = await getDoc(doc(db, 'products', productId));
                const product = productDoc.data();
                
                document.getElementById('productId').value = productId;
                document.getElementById('productCategory').value = product.category || '';
                document.getElementById('productName').value = product.name;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productImage').value = product.image || '';
                document.getElementById('productType').value = product.type;
                document.getElementById('productVisible').checked = product.visible;
                document.getElementById('productOffer').checked = product.isOffer || false;
                document.getElementById('productOfferDiscount').value = product.offerDiscount || 0;
                document.getElementById('offerDiscountGroup').style.display = product.isOffer ? 'block' : 'none';
                document.getElementById('productModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
                
                openModal('productModal');
            } catch (error) {
                console.error('[v0] Edit product error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬', 'error');
            }
        };

        window.deleteProduct = async (productId) => {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
            
            try {
                await deleteDoc(doc(db, 'products', productId));
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬');
            } catch (error) {
                console.error('[v0] Delete product error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬', 'error');
            }
        };

        // Admin Orders
        async function loadAdminOrders() {
            try {
                const q = query(collection(db, 'orders'), orderBy('createdAt', 'desc'));
                const unsub = onSnapshot(q, async (snapshot) => {
                    const tbody = document.getElementById('adminOrdersTableBody');
                    if (snapshot.empty) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>';
                        return;
                    }

                    tbody.innerHTML = '';
                    for (const orderDoc of snapshot.docs) {
                        const order = orderDoc.data();
                        const userDoc = await getDoc(doc(db, 'users', order.userId));
                        const username = userDoc.exists() ? userDoc.data().username : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${order.orderId}</td>
                            <td>${username}</td>
                            <td>${order.productName}</td>
                            <td>${formatPrice(order.price)}</td>
                            <td><span class="badge badge-${order.status}">${getStatusText(order.status)}</span></td>
                            <td>${order.createdAt ? new Date(order.createdAt.toDate()).toLocaleDateString('ar-EG') : '-'}</td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="window.updateOrderStatus('${orderDoc.id}')">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                });
                unsubscribers.push(unsub);
            } catch (error) {
                console.error('[v0] Load admin orders error:', error);
            }
        }

        window.updateOrderStatus = async (orderId) => {
            try {
                const orderDoc = await getDoc(doc(db, 'orders', orderId));
                const order = orderDoc.data();
                
                document.getElementById('statusOrderId').value = orderId;
                document.getElementById('orderStatus').value = order.status;
                
                openModal('orderStatusModal');
            } catch (error) {
                console.error('[v0] Get order for status update error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨', 'error');
            }
        };

        document.getElementById('orderStatusForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const orderId = document.getElementById('statusOrderId').value;
            const status = document.getElementById('orderStatus').value;

            try {
                const orderDoc = await getDoc(doc(db, 'orders', orderId));
                const order = orderDoc.data();
                
                await updateDoc(doc(db, 'orders', orderId), { status });
                
                // Send notification to user
                if (status === 'completed') {
                    await addNotification(
                        order.userId,
                        'Ø·Ù„Ø¨ Ù…ÙƒØªÙ…Ù„',
                        `ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø·Ù„Ø¨Ùƒ: ${order.productName}`,
                        'success'
                    );
                }
                
                closeModal('orderStatusModal');
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨');
            } catch (error) {
                console.error('[v0] Update order status error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨', 'error');
            }
        });

        async function loadAdminDeposits() {
            try {
                const q = query(collection(db, 'deposits'), orderBy('createdAt', 'desc'));
                const unsub = onSnapshot(q, async (snapshot) => {
                    const tbody = document.getElementById('adminDepositsTableBody');
                    if (snapshot.empty) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¥ÙŠØ¯Ø§Ø¹</td></tr>';
                        return;
                    }

                    tbody.innerHTML = '';
                    for (const depositDoc of snapshot.docs) {
                        const deposit = depositDoc.data();
                        const userDoc = await getDoc(doc(db, 'users', deposit.userId));
                        const username = userDoc.exists() ? userDoc.data().username : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${username}</td>
                            <td>${formatPrice(deposit.amount)}</td>
                            <td>${deposit.method === 'crypto' ? 'Ø¹Ù…Ù„Ø§Øª Ø±Ù‚Ù…ÙŠØ©' : 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´'}</td>
                            <td>${deposit.details}</td>
                            <td><span class="badge badge-${deposit.status}">${getDepositStatusText(deposit.status)}</span></td>
                            <td>${deposit.createdAt ? new Date(deposit.createdAt.toDate()).toLocaleDateString('ar-EG') : '-'}</td>
                            <td>
                                ${deposit.status === 'pending' ? `
                                    <button class="btn btn-success btn-sm" onclick="window.approveDeposit('${depositDoc.id}', '${deposit.userId}', ${deposit.amount})">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                                    <button class="btn btn-danger btn-sm" onclick="window.rejectDeposit('${depositDoc.id}', '${deposit.userId}')">Ø±ÙØ¶</button>
                                ` : '-'}
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                });
                unsubscribers.push(unsub);
            } catch (error) {
                console.error('[v0] Load admin deposits error:', error);
            }
        }

        window.approveDeposit = async (depositId, userId, amount) => {
            try {
                await updateDoc(doc(db, 'deposits', depositId), { status: 'approved' });
                
                const balanceSnap = await get(ref(rtdb, `balances/${userId}`));
                const currentBalance = balanceSnap.val()?.balance || 0;
                await set(ref(rtdb, `balances/${userId}`), { balance: currentBalance + amount });
                
                await addNotification(
                    userId,
                    'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹',
                    `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${formatPrice(amount)} Ø¥Ù„Ù‰ Ø±ØµÙŠØ¯Ùƒ`,
                    'success'
                );
                
                showToast('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹');
            } catch (error) {
                console.error('[v0] Approve deposit error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹', 'error');
            }
        };

        window.rejectDeposit = async (depositId, userId) => {
            try {
                await updateDoc(doc(db, 'deposits', depositId), { status: 'rejected' });
                
                await addNotification(
                    userId,
                    'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹',
                    'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.',
                    'error'
                );
                
                showToast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹');
            } catch (error) {
                console.error('[v0] Reject deposit error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹', 'error');
            }
        };

        async function loadAdminTickets() {
            try {
                const q = query(collection(db, 'tickets'), orderBy('updatedAt', 'desc'));
                const unsub = onSnapshot(q, (snapshot) => {
                    const container = document.getElementById('adminTicketsContainer');
                    if (snapshot.empty) {
                        container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ±</p>';
                        return;
                    }

                    container.innerHTML = '';
                    snapshot.docs.forEach(ticketDoc => {
                        const ticket = { id: ticketDoc.id, ...ticketDoc.data() };
                        const card = document.createElement('div');
                        card.className = 'ticket-card';
                        card.innerHTML = `
                            <div class="ticket-header">
                                <span class="ticket-id">${ticket.ticketId}</span>
                                <span class="badge badge-${ticket.status}">${getTicketStatusText(ticket.status)}</span>
                            </div>
                            <div class="ticket-subject">${ticket.subject}</div>
                            <div class="ticket-preview">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${ticket.username}</div>
                            <div class="ticket-meta">
                                <span>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ${getPriorityText(ticket.priority)}</span>
                                <span>${ticket.createdAt ? new Date(ticket.createdAt.toDate()).toLocaleDateString('ar-EG') : '-'}</span>
                            </div>
                        `;
                        card.onclick = () => viewAdminTicket(ticket.id);
                        container.appendChild(card);
                    });
                });
                unsubscribers.push(unsub);
            } catch (error) {
                console.error('[v0] Load admin tickets error:', error);
            }
        }

        async function viewAdminTicket(ticketId) {
            try {
                const ticketDoc = await getDoc(doc(db, 'tickets', ticketId));
                const ticket = ticketDoc.data();
                
                document.getElementById('ticketViewTitle').textContent = `ØªØ°ÙƒØ±Ø©: ${ticket.ticketId} - ${ticket.username}`;
                document.getElementById('ticketViewContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">${ticket.subject}</div>
                        <div style="display: flex; gap: 15px; font-size: 13px; color: var(--text-secondary);">
                            <span>Ø§Ù„Ø­Ø§Ù„Ø©: <span class="badge badge-${ticket.status}">${getTicketStatusText(ticket.status)}</span></span>
                            <span>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ${getPriorityText(ticket.priority)}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('replyTicketId').value = ticketId;
                
                const q = query(
                    collection(db, 'ticketMessages'),
                    where('ticketId', '==', ticketId),
                    orderBy('createdAt', 'asc')
                );
                const messagesSnap = await getDocs(q);
                const messagesContainer = document.getElementById('ticketViewMessages');
                messagesContainer.innerHTML = '';
                
                messagesSnap.docs.forEach(msgDoc => {
                    const msg = msgDoc.data();
                    const div = document.createElement('div');
                    div.className = 'ticket-message';
                    div.innerHTML = `
                        <div class="ticket-message-header">
                            <span class="ticket-message-sender">${msg.sender === 'user' ? msg.username : 'Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ'}</span>
                            <span>${msg.createdAt ? new Date(msg.createdAt.toDate()).toLocaleString('ar-EG') : '-'}</span>
                        </div>
                        <div class="ticket-message-body">${msg.message}</div>
                    `;
                    messagesContainer.appendChild(div);
                });
                
                openModal('ticketViewModal');
            } catch (error) {
                console.error('[v0] View admin ticket error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªØ°ÙƒØ±Ø©', 'error');
            }
        }

        // Admin Users
        async function loadAdminUsers() {
            try {
                const usersRef = collection(db, 'users');
                const unsub = onSnapshot(usersRef, async (snapshot) => {
                    const tbody = document.getElementById('adminUsersTableBody');
                    if (snapshot.empty) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</td></tr>';
                        return;
                    }

                    tbody.innerHTML = '';
                    for (const userDoc of snapshot.docs) {
                        const user = userDoc.data();
                        const balanceSnap = await get(ref(rtdb, `balances/${userDoc.id}`));
                        const balance = balanceSnap.val()?.balance || 0;
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.username}</td>
                            <td>${userDoc.id}</td>
                            <td>${user.role}</td>
                            <td>${user.verified ? 'Ù…ÙˆØ«Ù‚' : 'ØºÙŠØ± Ù…ÙˆØ«Ù‚'}</td>
                            <td>${formatPrice(balance)}</td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="window.editUser('${userDoc.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                });
                unsubscribers.push(unsub);
            } catch (error) {
                console.error('[v0] Load admin users error:', error);
            }
        }

        window.editUser = async (userId) => {
            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                const user = userDoc.data();
                const balanceSnap = await get(ref(rtdb, `balances/${userId}`));
                const balance = balanceSnap.val()?.balance || 0;
                
                document.getElementById('editUserId').value = userId;
                document.getElementById('editUserBalance').value = balance;
                document.getElementById('editUserRole').value = user.role;
                document.getElementById('editUserVerified').checked = user.verified;
                
                openModal('userEditModal');
            } catch (error) {
                console.error('[v0] Get user for edit error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
            }
        };

        document.getElementById('userEditForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const userId = document.getElementById('editUserId').value;
            const balance = parseFloat(document.getElementById('editUserBalance').value);
            const role = document.getElementById('editUserRole').value;
            const verified = document.getElementById('editUserVerified').checked;

            try {
                await updateDoc(doc(db, 'users', userId), { role, verified });
                await set(ref(rtdb, `balances/${userId}`), { balance });
                
                closeModal('userEditModal');
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            } catch (error) {
                console.error('[v0] Update user error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
            }
        });

        // Admin Settings
        async function loadAdminSettings() {
            try {
                const settingsDoc = await getDoc(doc(db, 'settings', 'site'));
                if (settingsDoc.exists()) {
                    const settings = settingsDoc.data();
                    document.getElementById('settingSiteTitle').value = settings.siteTitle || 'ÙÙŠÙˆÙ„ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†';
                    document.getElementById('settingSiteDescription').value = settings.siteDescription || '';
                    document.getElementById('settingWhatsapp').value = settings.whatsapp || '';
                    document.getElementById('settingTelegram').value = settings.telegram || '';
                    document.getElementById('settingUsdToEgp').value = settings.currencies?.USD || 30.5;
                    document.getElementById('settingEurToEgp').value = settings.currencies?.EUR || 33.2;
                    
                    exchangeRates.USD = settings.currencies?.USD || 30.5;
                    exchangeRates.EUR = settings.currencies?.EUR || 33.2;
                } else {
                    document.getElementById('settingSiteTitle').value = 'ÙÙŠÙˆÙ„ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†';
                    document.getElementById('settingSiteDescription').value = '';
                    document.getElementById('settingWhatsapp').value = '';
                    document.getElementById('settingTelegram').value = '';
                    document.getElementById('settingUsdToEgp').value = 30.5;
                    document.getElementById('settingEurToEgp').value = 33.2;
                }
            } catch (error) {
                console.error('[v0] Load settings error:', error);
            }
        }

        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const settings = {
                siteTitle: document.getElementById('settingSiteTitle').value.trim(),
                siteDescription: document.getElementById('settingSiteDescription').value.trim(),
                whatsapp: document.getElementById('settingWhatsapp').value.trim(),
                telegram: document.getElementById('settingTelegram').value.trim(),
                currencies: {
                    USD: parseFloat(document.getElementById('settingUsdToEgp').value),
                    EUR: parseFloat(document.getElementById('settingEurToEgp').value)
                }
            };

            try {
                await setDoc(doc(db, 'settings', 'site'), settings);
                exchangeRates = settings.currencies;
                siteSettings = settings;
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            } catch (error) {
                console.error('[v0] Save settings error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
            }
        });

        // Stats
        function loadStats() {
            const statsRef = ref(rtdb, 'stats/global');
            const unsub = onValue(statsRef, (snapshot) => {
                const stats = snapshot.val() || {};
                document.getElementById('footerActiveUsers').textContent = (stats.activeUsers || 33000).toLocaleString('ar-EG');
                document.getElementById('footerTotalOrders').textContent = (stats.totalOrders || 125000).toLocaleString('ar-EG');
                document.getElementById('footerDailyOrders').textContent = (stats.dailyOrders || 450).toLocaleString('ar-EG');
            });
            unsubscribers.push(unsub);
        }

        function loadAdminStats() {
            const statsRef = ref(rtdb, 'stats/global');
            onValue(statsRef, (snapshot) => {
                const stats = snapshot.val() || {};
                document.getElementById('statActiveUsers').value = stats.activeUsers || 33000;
                document.getElementById('statTotalOrders').value = stats.totalOrders || 125000;
                document.getElementById('statDailyOrders').value = stats.dailyOrders || 450;
            });
        }

        document.getElementById('statsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const stats = {
                activeUsers: parseInt(document.getElementById('statActiveUsers').value),
                totalOrders: parseInt(document.getElementById('statTotalOrders').value),
                dailyOrders: parseInt(document.getElementById('statDailyOrders').value)
            };

            try {
                await set(ref(rtdb, 'stats/global'), stats);
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
            } catch (error) {
                console.error('[v0] Update stats error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', 'error');
            }
        });

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggle = input.parentElement.querySelector('.password-toggle');
            
            if (input.type === 'password') {
                input.type = 'text';
                toggle.textContent = 'ğŸ™ˆ';
            } else {
                input.type = 'password';
                toggle.textContent = 'ğŸ‘ï¸';
            }
        }

        function checkPasswordStrength(password) {
            const strengthBar = document.getElementById('passwordStrengthBar');
            const strengthText = document.getElementById('passwordStrengthText');
            const strengthContainer = document.getElementById('passwordStrength');
            
            if (!password) {
                strengthContainer.classList.remove('show');
                strengthText.classList.remove('show');
                return;
            }
            
            strengthContainer.classList.add('show');
            strengthText.classList.add('show');
            
            let strength = 0;
            let text = '';
            let color = '';
            
            // Length check
            if (password.length >= 8) strength += 25;
            if (password.length >= 12) strength += 25;
            
            // Character variety checks
            if (/[a-z]/.test(password)) strength += 15;
            if (/[A-Z]/.test(password)) strength += 15;
            if (/[0-9]/.test(password)) strength += 10;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 10;
            
            if (strength < 30) {
                text = 'Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹';
                color = '#ef4444';
            } else if (strength < 50) {
                text = 'Ø¶Ø¹ÙŠÙØ©';
                color = '#f59e0b';
            } else if (strength < 75) {
                text = 'Ù…ØªÙˆØ³Ø·Ø©';
                color = '#eab308';
            } else if (strength < 90) {
                text = 'Ù‚ÙˆÙŠØ©';
                color = '#10b981';
            } else {
                text = 'Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹';
                color = '#059669';
            }
            
            strengthBar.style.width = strength + '%';
            strengthBar.style.backgroundColor = color;
            strengthText.textContent = `Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${text}`;
            strengthText.style.color = color;
        }

        function validateInput(inputId, errorId, validationFn, errorMsg) {
            const input = document.getElementById(inputId);
            const error = document.getElementById(errorId);
            
            if (!input) return true;
            
            const isValid = validationFn(input.value);
            
            if (!isValid && input.value) {
                input.classList.add('error');
                input.classList.remove('success');
                error.textContent = errorMsg;
                error.classList.add('show');
                return false;
            } else if (input.value) {
                input.classList.remove('error');
                input.classList.add('success');
                error.classList.remove('show');
                return true;
            } else {
                input.classList.remove('error', 'success');
                error.classList.remove('show');
                return true;
            }
        }

        // Added real-time input validation listeners
        document.getElementById('registerPassword')?.addEventListener('input', (e) => {
            checkPasswordStrength(e.target.value);
        });

        document.getElementById('registerUsername')?.addEventListener('blur', (e) => {
            const username = e.target.value.trim();
            if (username) {
                validateInput('registerUsername', 'registerUsernameError', 
                    (val) => val.length >= 3 && /^[a-z0-9_]+$/.test(val),
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙˆÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·'
                );
            }
        });

        document.getElementById('registerEmail')?.addEventListener('blur', (e) => {
            const email = e.target.value.trim();
            if (email) {
                validateInput('registerEmail', 'registerEmailError',
                    (val) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val),
                    'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­'
                );
            }
        });
    </script>
</body>
</html>
