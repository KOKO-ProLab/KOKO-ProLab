<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - KOKO ProLab</title>
    <style>
        :root {
            --primary-color: #3d5afe;
            --background-light: #f5f7fa;
            --surface-light: #ffffff;
            --text-light: #212121;
            --border-color: #e0e0e0;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --border-radius: 8px;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-light);
            color: var(--text-light);
            margin: 0;
            display: flex;
            height: 100vh;
        }

        #admin-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        #admin-sidebar {
            width: 250px;
            background-color: var(--surface-light);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        #admin-sidebar h1 {
            color: var(--primary-color);
            margin: 0 0 2rem 0;
            font-size: 1.8rem;
        }

        #admin-sidebar nav a {
            display: block;
            padding: 0.8rem 1rem;
            text-decoration: none;
            color: var(--text-light);
            font-weight: 600;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            transition: background-color 0.2s;
        }

        #admin-sidebar nav a:hover, #admin-sidebar nav a.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        #admin-sidebar .user-info {
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        #admin-main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .page { display: none; }
        .page.active { display: block; }
        
        #loading, #unauthorized {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            font-size: 1.5rem;
            flex-direction: column;
            text-align: center;
        }

        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

    <div id="loading">
        <div class="loader"></div>
        <p>Verifying Access...</p>
    </div>

    <div id="unauthorized" style="display: none;">
        <h2>Access Denied</h2>
        <p>You do not have permission to view this page. Redirecting...</p>
    </div>
    
    <div id="admin-container" style="display: none;">
        <aside id="admin-sidebar">
            <h1>KOKO ProLab</h1>
            <nav>
                <a href="#" class="nav-link active" data-page="dashboard">Dashboard</a>
                <a href="#" class="nav-link" data-page="products">Products</a>
                <a href="#" class="nav-link" data-page="orders">Orders</a>
                <a href="#" class="nav-link" data-page="users">Users</a>
                <a href="#" class="nav-link" data-page="settings">Settings</a>
            </nav>
            <div id="admin-user-info" class="user-info">
                 <!-- Populated by JS -->
            </div>
        </aside>
        
        <main id="admin-main">
            <section id="dashboard" class="page active">
                <h2>Dashboard</h2>
                <p>Welcome to the admin panel. Key metrics will be displayed here.</p>
            </section>
            <section id="products" class="page">
                <h2>Product Management</h2>
                <p>Here you can add, edit, and remove services.</p>
            </section>
            <section id="orders" class="page">
                <h2>Order Management</h2>
                <p>View and manage all user orders.</p>
            </section>
            <section id="users" class="page">
                <h2>User Management</h2>
                <p>Browse and manage user accounts.</p>
            </section>
            <section id="settings" class="page">
                <h2>Site Settings</h2>
                <p>Manage site-wide settings, payment info, and more.</p>
            </section>
        </main>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDUaSnYinH910wp3zDHOCNuqWp9QjwIRow",
            authDomain: "koko-prolab.firebaseapp.com",
            projectId: "koko-prolab",
            storageBucket: "koko-prolab.appspot.com",
            messagingSenderId: "61256824707",
            appId: "1:61256824707:web:a853065ec0a19f8d57e8b6",
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', () => {
            const loadingEl = document.getElementById('loading');
            const unauthorizedEl = document.getElementById('unauthorized');
            const adminContainerEl = document.getElementById('admin-container');
            
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in, check for admin role.
                    const userRef = db.collection('users').doc(user.uid);
                    userRef.get().then(doc => {
                        if (doc.exists && doc.data().role === 'admin') {
                            // User is an admin, show the panel.
                            loadingEl.style.display = 'none';
                            adminContainerEl.style.display = 'flex';
                            setupAdminPanel(user, doc.data());
                        } else {
                            // User is not an admin.
                            showUnauthorized();
                        }
                    }).catch(showUnauthorized);
                } else {
                    // No user is signed in.
                    showUnauthorized();
                }
            });

            function showUnauthorized() {
                loadingEl.style.display = 'none';
                unauthorizedEl.style.display = 'flex';
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            }

            function setupAdminPanel(user, userData) {
                // Display user info
                document.getElementById('admin-user-info').innerHTML = `
                    <p><strong>${userData.username}</strong></p>
                    <p>${user.email}</p>
                    <a href="#" id="admin-logout">Logout</a>
                `;
                document.getElementById('admin-logout').addEventListener('click', e => {
                    e.preventDefault();
                    auth.signOut();
                });

                // Navigation
                const navLinks = document.querySelectorAll('.nav-link');
                const pages = document.querySelectorAll('.page');
                navLinks.forEach(link => {
                    link.addEventListener('click', e => {
                        e.preventDefault();
                        const pageId = link.dataset.page;
                        
                        navLinks.forEach(l => l.classList.remove('active'));
                        pages.forEach(p => p.classList.remove('active'));

                        link.classList.add('active');
                        document.getElementById(pageId).classList.add('active');
                    });
                });
            }
        });
    </script>
</body>
</html>
