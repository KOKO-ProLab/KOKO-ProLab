<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fule Online - منصة الخدمات الرقمية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* GLOBAL STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1e40af;
            --primary-dark: #1e3a8a;
            --accent: #f97316;
            --accent-dark: #ea580c;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        [data-theme="dark"] {
            --bg-light: #0f172a;
            --bg-white: #1e293b;
            --text-dark: #f1f5f9;
            --text-gray: #94a3b8;
            --border: #334155;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* HEADER & NAVIGATION */
        .header {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            gap: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            list-style: none;
            flex: 1;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .balance-display {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text-dark);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-white);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 0.5rem;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.3s;
            border-bottom: 1px solid var(--border);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--bg-light);
        }

        .theme-toggle {
            background: var(--bg-light);
            border: 1px solid var(--border);
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* BUTTONS */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Cairo', sans-serif;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background: var(--accent-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* CARDS */
        .card {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .product-card {
            background: var(--bg-white);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--bg-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--text-gray);
        }

        .product-content {
            padding: 1.5rem;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .product-description {
            color: var(--text-gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* FORMS */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            background: var(--bg-white);
            color: var(--text-dark);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-gray);
        }

        /* ADMIN PANEL */
        .admin-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .admin-sidebar {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .admin-menu {
            list-style: none;
        }

        .admin-menu-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .admin-menu-item:hover,
        .admin-menu-item.active {
            background: var(--primary);
            color: white;
        }

        /* STATS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            opacity: 0.9;
        }

        /* FLOATING CHAT */
        .floating-chat {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--accent);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1500;
            transition: transform 0.3s;
        }

        .floating-chat:hover {
            transform: scale(1.1);
        }

        /* CONTACT BUTTONS */
        .contact-buttons {
            position: fixed;
            bottom: 90px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1500;
        }

        .contact-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .contact-btn:hover {
            transform: scale(1.1);
        }

        .whatsapp-btn {
            background: #25d366;
        }

        .telegram-btn {
            background: #0088cc;
        }

        /* TABLE */
        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: right;
            border-bottom: 1px solid var(--border);
        }

        .table th {
            background: var(--bg-light);
            font-weight: 700;
        }

        /* BADGE */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        /* CURRENCY SELECTOR */
        .currency-selector {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-white);
            color: var(--text-dark);
            font-family: 'Cairo', sans-serif;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .admin-layout {
                grid-template-columns: 1fr;
            }

            .admin-sidebar {
                position: static;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* HIDDEN */
        .hidden {
            display: none !important;
        }

        /* HERO SECTION */
        .hero {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 4rem 0;
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* SECTION */
        .section {
            padding: 3rem 0;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 1rem;
            border-bottom: 2px solid var(--border);
            margin-bottom: 2rem;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
     HEADER 
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="#" class="logo" onclick="showSection('home')">Fule Online</a>
                
                <ul class="nav-links" id="navLinks">
                    <li><a href="#" onclick="showSection('home')">الرئيسية</a></li>
                    <li><a href="#" onclick="showSection('smm')">خدمات SMM</a></li>
                    <li><a href="#" onclick="showSection('real-products')">منتجات حقيقية</a></li>
                    <li><a href="#" onclick="showSection('digital-products')">منتجات رقمية</a></li>
                    <li><a href="#" onclick="showSection('website-design')">طلب تصميم موقع</a></li>
                    <li><a href="#" onclick="showSection('offers')">العروض</a></li>
                    <li><a href="#" onclick="showSection('support')">الدعم الفني</a></li>
                </ul>

                <div class="nav-actions">
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>

                    <select class="currency-selector" id="currencySelector" onchange="changeCurrency()">
                        <option value="USD">USD</option>
                        <option value="EGP">EGP</option>
                        <option value="SAR">SAR</option>
                        <option value="AED">AED</option>
                    </select>

                    <div id="authButtons">
                        <button class="btn btn-primary" onclick="showModal('loginModal')">تسجيل الدخول</button>
                        <button class="btn btn-accent" onclick="showModal('signupModal')">إنشاء حساب</button>
                    </div>

                    <div id="userActions" class="hidden">
                        <div class="balance-display">
                            <i class="fas fa-wallet"></i>
                            <span id="balanceDisplay">0</span>
                        </div>

                        <div class="notification-icon" onclick="toggleNotifications()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge">0</span>
                        </div>

                        <div class="profile-dropdown">
                            <button class="profile-btn" onclick="toggleProfileMenu()">
                                <i class="fas fa-user"></i>
                                <span id="userDisplayName">المستخدم</span>
                            </button>
                            <div class="dropdown-menu" id="profileMenu">
                                <div class="dropdown-item" onclick="showSection('profile')">
                                    <i class="fas fa-user"></i> ملفي
                                </div>
                                <div class="dropdown-item" onclick="showSection('settings')">
                                    <i class="fas fa-cog"></i> الإعدادات
                                </div>
                                <div class="dropdown-item" onclick="logout()">
                                    <i class="fas fa-sign-out-alt"></i> تسجيل خروج
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

     MAIN CONTENT 
    <main class="container">
         HOME SECTION 
        <section id="homeSection" class="section">
            <div class="hero">
                <h1 class="hero-title">مرحباً بك في Fule Online</h1>
                <p class="hero-subtitle">منصتك الشاملة للخدمات الرقمية والمنتجات</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="activeUsers">33,000</div>
                    <div class="stat-label">مستخدم نشط</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="completedOrders">15,420</div>
                    <div class="stat-label">طلب مكتمل</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="satisfiedCustomers">98%</div>
                    <div class="stat-label">رضا العملاء</div>
                </div>
            </div>

            <h2 class="section-title">الخدمات المميزة</h2>
            <div class="product-grid" id="featuredProducts"></div>
        </section>

         SMM SERVICES SECTION 
        <section id="smmSection" class="section hidden">
            <h2 class="section-title">خدمات SMM</h2>
            <div class="product-grid" id="smmProducts"></div>
        </section>

         REAL PRODUCTS SECTION 
        <section id="realProductsSection" class="section hidden">
            <h2 class="section-title">منتجات حقيقية</h2>
            <div class="product-grid" id="realProducts"></div>
        </section>

         DIGITAL PRODUCTS SECTION 
        <section id="digitalProductsSection" class="section hidden">
            <h2 class="section-title">منتجات رقمية</h2>
            <div class="product-grid" id="digitalProducts"></div>
        </section>

         WEBSITE DESIGN SECTION 
        <section id="websiteDesignSection" class="section hidden">
            <h2 class="section-title">طلب تصميم موقع</h2>
            <div class="card">
                <form id="websiteDesignForm" onsubmit="submitWebsiteDesign(event)">
                    <div class="form-group">
                        <label class="form-label">نوع الموقع</label>
                        <select class="form-input" required>
                            <option value="">اختر نوع الموقع</option>
                            <option value="business">موقع شركة</option>
                            <option value="ecommerce">متجر إلكتروني</option>
                            <option value="portfolio">معرض أعمال</option>
                            <option value="blog">مدونة</option>
                            <option value="custom">مخصص</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">وصف المشروع</label>
                        <textarea class="form-input" rows="5" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">الميزانية المتوقعة</label>
                        <input type="text" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary">إرسال الطلب</button>
                </form>
            </div>
        </section>

         OFFERS SECTION 
        <section id="offersSection" class="section hidden">
            <h2 class="section-title">العروض الخاصة</h2>
            <div class="product-grid" id="offersProducts"></div>
        </section>

         SUPPORT SECTION 
        <section id="supportSection" class="section hidden">
            <h2 class="section-title">الدعم الفني</h2>
            
            <div class="tabs">
                <div class="tab active" onclick="switchTab('myTickets')">تذاكري</div>
                <div class="tab" onclick="switchTab('newTicket')">تذكرة جديدة</div>
            </div>

            <div class="tab-content active" id="myTicketsTab">
                <div id="ticketsList"></div>
            </div>

            <div class="tab-content" id="newTicketTab">
                <div class="card">
                    <form id="newTicketForm" onsubmit="createTicket(event)">
                        <div class="form-group">
                            <label class="form-label">الموضوع</label>
                            <input type="text" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">الرسالة</label>
                            <textarea class="form-input" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">إرسال التذكرة</button>
                    </form>
                </div>
            </div>
        </section>

         PROFILE SECTION 
        <section id="profileSection" class="section hidden">
            <h2 class="section-title">ملفي الشخصي</h2>
            <div class="card">
                <div class="form-group">
                    <label class="form-label">اسم المستخدم</label>
                    <input type="text" class="form-input" id="profileUsername" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">الاسم المعروض</label>
                    <input type="text" class="form-input" id="profileDisplayName">
                </div>
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-input" id="profileEmail" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">الحالة</label>
                    <span class="badge badge-success" id="verifiedBadge">موثق</span>
                </div>
                <button class="btn btn-primary" onclick="updateProfile()">حفظ التغييرات</button>
            </div>

            <h3 class="section-title" style="margin-top: 2rem;">طلباتي</h3>
            <div id="userOrders"></div>

            <h3 class="section-title" style="margin-top: 2rem;">المحفظة</h3>
            <div class="card">
                <button class="btn btn-accent" onclick="showModal('depositModal')">إيداع رصيد</button>
            </div>
        </section>

         ADMIN SECTION 
        <section id="adminSection" class="section hidden">
            <h2 class="section-title">لوحة الإدارة</h2>
            
            <div class="admin-layout">
                <aside class="admin-sidebar">
                    <ul class="admin-menu">
                        <li class="admin-menu-item active" onclick="switchAdminTab('products')">
                            <i class="fas fa-box"></i> المنتجات
                        </li>
                        <li class="admin-menu-item" onclick="switchAdminTab('orders')">
                            <i class="fas fa-shopping-cart"></i> الطلبات
                        </li>
                        <li class="admin-menu-item" onclick="switchAdminTab('deposits')">
                            <i class="fas fa-money-bill"></i> الإيداعات
                        </li>
                        <li class="admin-menu-item" onclick="switchAdminTab('users')">
                            <i class="fas fa-users"></i> المستخدمين
                        </li>
                        <li class="admin-menu-item" onclick="switchAdminTab('tickets')">
                            <i class="fas fa-ticket-alt"></i> التذاكر
                        </li>
                        <li class="admin-menu-item" onclick="switchAdminTab('coupons')">
                            <i class="fas fa-tag"></i> الكوبونات
                        </li>
                        <li class="admin-menu-item" onclick="switchAdminTab('settings')">
                            <i class="fas fa-cog"></i> الإعدادات
                        </li>
                        <li class="admin-menu-item" onclick="switchAdminTab('logs')">
                            <i class="fas fa-file-alt"></i> السجلات
                        </li>
                    </ul>
                </aside>

                <div class="admin-content">
                     PRODUCTS TAB 
                    <div id="adminProductsTab" class="tab-content active">
                        <button class="btn btn-primary" onclick="showModal('addProductModal')" style="margin-bottom: 1rem;">
                            <i class="fas fa-plus"></i> إضافة منتج
                        </button>
                        <div id="adminProductsList"></div>
                    </div>

                     ORDERS TAB 
                    <div id="adminOrdersTab" class="tab-content">
                        <div id="adminOrdersList"></div>
                    </div>

                     DEPOSITS TAB 
                    <div id="adminDepositsTab" class="tab-content">
                        <div id="adminDepositsList"></div>
                    </div>

                     USERS TAB 
                    <div id="adminUsersTab" class="tab-content">
                        <div id="adminUsersList"></div>
                    </div>

                     TICKETS TAB 
                    <div id="adminTicketsTab" class="tab-content">
                        <div id="adminTicketsList"></div>
                    </div>

                     COUPONS TAB 
                    <div id="adminCouponsTab" class="tab-content">
                        <button class="btn btn-primary" onclick="showModal('addCouponModal')" style="margin-bottom: 1rem;">
                            <i class="fas fa-plus"></i> إضافة كوبون
                        </button>
                        <div id="adminCouponsList"></div>
                    </div>

                     SETTINGS TAB 
                    <div id="adminSettingsTab" class="tab-content">
                        <div class="card">
                            <h3>إعدادات الموقع</h3>
                            <div class="form-group">
                                <label class="form-label">عنوان الموقع</label>
                                <input type="text" class="form-input" id="siteTitle">
                            </div>
                            <div class="form-group">
                                <label class="form-label">وصف الموقع</label>
                                <textarea class="form-input" id="siteDescription" rows="3"></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="updateSiteSettings()">حفظ الإعدادات</button>
                        </div>

                        <div class="card" style="margin-top: 1rem;">
                            <h3>الإحصائيات الوهمية</h3>
                            <div class="form-group">
                                <label class="form-label">المستخدمين النشطين</label>
                                <input type="number" class="form-input" id="fakeActiveUsers">
                            </div>
                            <div class="form-group">
                                <label class="form-label">الطلبات المكتملة</label>
                                <input type="number" class="form-input" id="fakeCompletedOrders">
                            </div>
                            <button class="btn btn-primary" onclick="updateFakeStats()">تحديث الإحصائيات</button>
                        </div>
                    </div>

                     LOGS TAB 
                    <div id="adminLogsTab" class="tab-content">
                        <button class="btn btn-accent" onclick="exportLogs()" style="margin-bottom: 1rem;">
                            <i class="fas fa-download"></i> تصدير السجلات
                        </button>
                        <div id="adminLogsList"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

     FLOATING CHAT 
    <div class="floating-chat" onclick="openLiveChat()">
        <i class="fas fa-comments"></i>
    </div>

     CONTACT BUTTONS 
    <div class="contact-buttons">
        <a href="https://wa.me/YOUR_NUMBER" target="_blank" class="contact-btn whatsapp-btn">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="https://t.me/YOUR_USERNAME" target="_blank" class="contact-btn telegram-btn">
            <i class="fab fa-telegram"></i>
        </a>
    </div>

     MODALS 
     LOGIN MODAL 
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">تسجيل الدخول</h2>
                <button class="modal-close" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <form id="loginForm" onsubmit="login(event)">
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-input" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">تسجيل الدخول</button>
                <p style="text-align: center; margin-top: 1rem;">
                    <a href="#" onclick="showModal('resetPasswordModal'); closeModal('loginModal');">نسيت كلمة المرور؟</a>
                </p>
            </form>
        </div>
    </div>

     SIGNUP MODAL 
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إنشاء حساب جديد</h2>
                <button class="modal-close" onclick="closeModal('signupModal')">&times;</button>
            </div>
            <form id="signupForm" onsubmit="signup(event)">
                <div class="form-group">
                    <label class="form-label">اسم المستخدم</label>
                    <input type="text" class="form-input" id="signupUsername" required>
                </div>
                <div class="form-group">
                    <label class="form-label">الاسم المعروض</label>
                    <input type="text" class="form-input" id="signupDisplayName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-input" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-input" id="signupPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">إنشاء حساب</button>
            </form>
        </div>
    </div>

     RESET PASSWORD MODAL 
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إعادة تعيين كلمة المرور</h2>
                <button class="modal-close" onclick="closeModal('resetPasswordModal')">&times;</button>
            </div>
            <form id="resetPasswordForm" onsubmit="resetPassword(event)">
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-input" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">إرسال رابط إعادة التعيين</button>
            </form>
        </div>
    </div>

     PRODUCT DETAILS MODAL 
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="productModalTitle">تفاصيل المنتج</h2>
                <button class="modal-close" onclick="closeModal('productModal')">&times;</button>
            </div>
            <div id="productModalContent"></div>
        </div>
    </div>

     CHECKOUT MODAL 
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إتمام الطلب</h2>
                <button class="modal-close" onclick="closeModal('checkoutModal')">&times;</button>
            </div>
            <form id="checkoutForm" onsubmit="submitOrder(event)">
                <div id="checkoutDynamicFields"></div>
                <div class="form-group">
                    <label class="form-label">تفاصيل إضافية (اختياري)</label>
                    <textarea class="form-input" rows="3" id="orderDetails"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">طريقة الدفع</label>
                    <select class="form-input" id="paymentMethod" required>
                        <option value="">اختر طريقة الدفع</option>
                        <option value="balance">الرصيد</option>
                        <option value="crypto">عملات رقمية</option>
                        <option value="vodafone">فودافون كاش</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">كود الخصم (اختياري)</label>
                    <input type="text" class="form-input" id="couponCode">
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>السعر النهائي: </strong>
                    <span id="finalPrice">0</span>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">تأكيد الطلب</button>
            </form>
        </div>
    </div>

     DEPOSIT MODAL 
    <div id="depositModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إيداع رصيد</h2>
                <button class="modal-close" onclick="closeModal('depositModal')">&times;</button>
            </div>
            <form id="depositForm" onsubmit="submitDeposit(event)">
                <div class="form-group">
                    <label class="form-label">المبلغ</label>
                    <input type="number" class="form-input" required min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">طريقة الدفع</label>
                    <select class="form-input" required>
                        <option value="">اختر طريقة الدفع</option>
                        <option value="crypto">عملات رقمية</option>
                        <option value="vodafone">فودافون كاش</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">إرسال طلب الإيداع</button>
            </form>
        </div>
    </div>

     ADD PRODUCT MODAL (ADMIN) 
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إضافة منتج جديد</h2>
                <button class="modal-close" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <form id="addProductForm" onsubmit="addProduct(event)">
                <div class="form-group">
                    <label class="form-label">العنوان</label>
                    <input type="text" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">النوع</label>
                    <select class="form-input" required>
                        <option value="">اختر النوع</option>
                        <option value="smm">خدمات SMM</option>
                        <option value="real">منتج حقيقي</option>
                        <option value="digital">منتج رقمي</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">الوصف</label>
                    <textarea class="form-input" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">السعر</label>
                    <input type="number" class="form-input" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">العملة</label>
                    <select class="form-input" required>
                        <option value="USD">USD</option>
                        <option value="EGP">EGP</option>
                        <option value="SAR">SAR</option>
                        <option value="AED">AED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">المخزون</label>
                    <input type="number" class="form-input" required min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">رابط الصورة (اختياري)</label>
                    <input type="url" class="form-input">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">إضافة المنتج</button>
            </form>
        </div>
    </div>

     ADD COUPON MODAL (ADMIN) 
    <div id="addCouponModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">إضافة كوبون جديد</h2>
                <button class="modal-close" onclick="closeModal('addCouponModal')">&times;</button>
            </div>
            <form id="addCouponForm" onsubmit="addCoupon(event)">
                <div class="form-group">
                    <label class="form-label">الكود</label>
                    <input type="text" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">نسبة الخصم (%)</label>
                    <input type="number" class="form-input" required min="1" max="100">
                </div>
                <div class="form-group">
                    <label class="form-label">تاريخ الانتهاء</label>
                    <input type="date" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">عدد الاستخدامات المتاحة</label>
                    <input type="number" class="form-input" required min="1">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">إضافة الكوبون</button>
            </form>
        </div>
    </div>

     LIVE CHAT MODAL 
    <div id="liveChatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">الدعم المباشر</h2>
                <button class="modal-close" onclick="closeModal('liveChatModal')">&times;</button>
            </div>
            <div id="chatMessages" style="height: 400px; overflow-y: auto; border: 1px solid var(--border); padding: 1rem; margin-bottom: 1rem; border-radius: 8px;">
            </div>
            <form id="chatForm" onsubmit="sendChatMessage(event)">
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" class="form-input" id="chatInput" placeholder="اكتب رسالتك..." required>
                    <button type="submit" class="btn btn-primary">إرسال</button>
                </div>
            </form>
        </div>
    </div>

     FIREBASE SDK 
    <script type="module">
        /* FIREBASE CONFIG HERE */
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendPasswordResetEmail, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDoc, getDocs, query, where, onSnapshot, orderBy, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
        import { getDatabase, ref, set, get, update, onValue, push } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCcxGOaiiy6Dy1MybOIOxn69xab4rsOOJ0",
            authDomain: "koko-caffe.firebaseapp.com",
            databaseURL: "https://koko-caffe-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "koko-caffe",
            storageBucket: "koko-caffe.firestorage.app",
            messagingSenderId: "382318796715",
            appId: "1:382318796715:web:ee9f3aca9a107f86da7cee",
            measurementId: "G-B83G77QPWW"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const rtdb = getDatabase(app);

        // Make Firebase available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseRtdb = rtdb;
        window.firebaseModules = {
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            sendPasswordResetEmail,
            onAuthStateChanged,
            collection,
            addDoc,
            updateDoc,
            deleteDoc,
            doc,
            getDoc,
            getDocs,
            query,
            where,
            onSnapshot,
            orderBy,
            serverTimestamp,
            ref,
            set,
            get,
            update,
            onValue,
            push
        };

        // Global state
        window.currentUser = null;
        window.currentUserData = null;
        window.currentCurrency = 'USD';
        window.currentProduct = null;

        /* AUTH: signup/login/reset */
        // AUTH STATE LISTENER
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                window.currentUser = user;
                await loadUserData(user.uid);
                showUserInterface();
                listenToBalance(user.uid);
                listenToNotifications(user.uid);
                loadProducts();
                
                loadUserTickets();
                loadUserOrders();
                
                // Check if admin
                if (window.currentUserData?.role === 'admin') {
                    document.getElementById('navLinks').innerHTML += '<li><a href="#" onclick="showSection(\'admin\')">الإدارة</a></li>';
                    loadAdminData();
                }
            } else {
                window.currentUser = null;
                window.currentUserData = null;
                showAuthInterface();
            }
        });

        async function loadUserData(uid) {
            const userDoc = await getDoc(doc(db, 'users', uid));
            if (userDoc.exists()) {
                window.currentUserData = { id: uid, ...userDoc.data() };
                document.getElementById('userDisplayName').textContent = window.currentUserData.displayName || 'المستخدم';
            }
        }

        /* onValue(balances/{uid}) */
        function listenToBalance(uid) {
            const balanceRef = ref(rtdb, `balances/${uid}`);
            onValue(balanceRef, (snapshot) => {
                const balance = snapshot.val() || 0;
                document.getElementById('balanceDisplay').textContent = `${balance.toFixed(2)} ${window.currentCurrency}`;
            });
        }

        /* onValue(notifications/{uid}) */
        function listenToNotifications(uid) {
            const notificationsRef = ref(rtdb, `notifications/${uid}`);
            onValue(notificationsRef, (snapshot) => {
                const notifications = snapshot.val() || {};
                const unreadCount = Object.values(notifications).filter(n => !n.read).length;
                document.getElementById('notificationBadge').textContent = unreadCount;
            });
        }

        /* onSnapshot(products) */
        function loadProducts() {
            const productsRef = collection(db, 'products');
            onSnapshot(query(productsRef, where('visible', '==', true)), (snapshot) => {
                const products = [];
                snapshot.forEach((doc) => {
                    products.push({ id: doc.id, ...doc.data() });
                });
                
                displayProducts(products);
            });
        }

        function displayProducts(products) {
            const smmProducts = products.filter(p => p.type === 'smm');
            const realProducts = products.filter(p => p.type === 'real');
            const digitalProducts = products.filter(p => p.type === 'digital');
            const featured = products.slice(0, 6);

            renderProductGrid('featuredProducts', featured);
            renderProductGrid('smmProducts', smmProducts);
            renderProductGrid('realProducts', realProducts);
            renderProductGrid('digitalProducts', digitalProducts);
        }

        function renderProductGrid(elementId, products) {
            const grid = document.getElementById(elementId);
            if (!grid) return;

            grid.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="product-image">
                        ${product.imageUrl ? `<img src="${product.imageUrl}" alt="${product.title}" style="width: 100%; height: 100%; object-fit: cover;">` : '<i class="fas fa-box"></i>'}
                    </div>
                    <div class="product-content">
                        <h3 class="product-title">${product.title}</h3>
                        <p class="product-description">${product.description}</p>
                        <div class="product-price">${product.price} ${product.currency}</div>
                        <button class="btn btn-primary" onclick="viewProduct('${product.id}')" style="width: 100%;">
                            عرض التفاصيل
                        </button>
                    </div>
                </div>
            `).join('');
        }

        window.viewProduct = async function(productId) {
            const productDoc = await getDoc(doc(db, 'products', productId));
            if (productDoc.exists()) {
                const product = { id: productId, ...productDoc.data() };
                window.currentProduct = product;
                
                const modalContent = document.getElementById('productModalContent');
                modalContent.innerHTML = `
                    <div class="product-image" style="margin-bottom: 1rem;">
                        ${product.imageUrl ? `<img src="${product.imageUrl}" alt="${product.title}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px;">` : '<i class="fas fa-box"></i>'}
                    </div>
                    <h3>${product.title}</h3>
                    <p>${product.description}</p>
                    <div class="product-price" style="margin: 1rem 0;">${product.price} ${product.currency}</div>
                    <p><strong>المخزون:</strong> ${product.stock}</p>
                    <button class="btn btn-primary" onclick="startCheckout()" style="width: 100%; margin-top: 1rem;">
                        شراء الآن
                    </button>
                `;
                
                showModal('productModal');
            }
        };

        window.startCheckout = function() {
            if (!window.currentUser) {
                alert('يرجى تسجيل الدخول أولاً');
                closeModal('productModal');
                showModal('loginModal');
                return;
            }

            const product = window.currentProduct;
            const dynamicFields = document.getElementById('checkoutDynamicFields');
            
            if (product.adminFields && product.adminFields.length > 0) {
                dynamicFields.innerHTML = product.adminFields.map((field, index) => `
                    <div class="form-group">
                        <label class="form-label">${field.label} ${field.required ? '*' : '(اختياري)'}</label>
                        <input type="text" class="form-input" data-field-index="${index}" ${field.required ? 'required' : ''} placeholder="${field.hint || ''}">
                    </div>
                `).join('');
            } else {
                dynamicFields.innerHTML = '';
            }

            document.getElementById('finalPrice').textContent = `${product.price} ${product.currency}`;
            
            closeModal('productModal');
            showModal('checkoutModal');
        };

        /* CALL createOrder() */
        window.submitOrder = async function(event) {
            event.preventDefault();
            
            if (!window.currentUser || !window.currentProduct) return;

            const form = event.target;
            const paymentMethod = form.querySelector('#paymentMethod').value;
            const orderDetails = form.querySelector('#orderDetails').value;
            const couponCode = form.querySelector('#couponCode').value;

            // Collect dynamic fields
            const dynamicFieldsData = {};
            const dynamicInputs = form.querySelectorAll('[data-field-index]');
            dynamicInputs.forEach(input => {
                const index = input.getAttribute('data-field-index');
                const field = window.currentProduct.adminFields[index];
                dynamicFieldsData[field.label] = input.value;
            });

            try {
                // Create order in Firestore
                const orderData = {
                    userId: window.currentUser.uid,
                    productId: window.currentProduct.id,
                    productTitle: window.currentProduct.title,
                    price: window.currentProduct.price,
                    currency: window.currentProduct.currency,
                    paymentMethod,
                    orderDetails,
                    dynamicFields: dynamicFieldsData,
                    couponCode,
                    status: 'pending',
                    createdAt: serverTimestamp()
                };

                await addDoc(collection(db, 'orders'), orderData);

                // Log admin action
                await addDoc(collection(db, 'adminLogs'), {
                    action: 'order_created',
                    userId: window.currentUser.uid,
                    orderId: 'pending',
                    timestamp: serverTimestamp()
                });

                alert('تم إرسال طلبك بنجاح! سيتم مراجعته قريباً.');
                closeModal('checkoutModal');
                form.reset();
            } catch (error) {
                console.error('Error creating order:', error);
                alert('حدث خطأ أثناء إرسال الطلب');
            }
        };

        // SIGNUP
        window.signup = async function(event) {
            event.preventDefault();
            const form = event.target;
            const username = form.querySelector('#signupUsername').value;
            const displayName = form.querySelector('#signupDisplayName').value;
            const email = form.querySelector('#signupEmail').value;
            const password = form.querySelector('#signupPassword').value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Create user document in Firestore
                await set(doc(db, 'users', user.uid), {
                    username,
                    displayName,
                    email,
                    role: 'user',
                    verified: false,
                    createdAt: serverTimestamp()
                });

                // Initialize balance in Realtime DB
                await set(ref(rtdb, `balances/${user.uid}`), 0);

                alert('تم إنشاء الحساب بنجاح!');
                closeModal('signupModal');
                form.reset();
            } catch (error) {
                console.error('Signup error:', error);
                alert('حدث خطأ: ' + error.message);
            }
        };

        // LOGIN
        window.login = async function(event) {
            event.preventDefault();
            const form = event.target;
            const email = form.querySelector('input[type="email"]').value;
            const password = form.querySelector('input[type="password"]').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                closeModal('loginModal');
                form.reset();
            } catch (error) {
                console.error('Login error:', error);
                alert('حدث خطأ: ' + error.message);
            }
        };

        // LOGOUT
        window.logout = async function() {
            try {
                await signOut(auth);
                location.reload();
            } catch (error) {
                console.error('Logout error:', error);
            }
        };

        // RESET PASSWORD
        window.resetPassword = async function(event) {
            event.preventDefault();
            const form = event.target;
            const email = form.querySelector('input[type="email"]').value;

            try {
                await sendPasswordResetEmail(auth, email);
                alert('تم إرسال رابط إعادة تعيين كلمة المرور إلى بريدك الإلكتروني');
                closeModal('resetPasswordModal');
                form.reset();
            } catch (error) {
                console.error('Reset password error:', error);
                alert('حدث خطأ: ' + error.message);
            }
        };

        // UPDATE PROFILE
        window.updateProfile = async function() {
            if (!window.currentUser) return;

            const displayName = document.getElementById('profileDisplayName').value;

            try {
                await updateDoc(doc(db, 'users', window.currentUser.uid), {
                    displayName
                });

                alert('تم تحديث الملف الشخصي بنجاح');
                await loadUserData(window.currentUser.uid);
            } catch (error) {
                console.error('Update profile error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        // DEPOSIT
        window.submitDeposit = async function(event) {
            event.preventDefault();
            
            if (!window.currentUser) return;

            const form = event.target;
            const amount = parseFloat(form.querySelector('input[type="number"]').value);
            const method = form.querySelector('select').value;

            try {
                await addDoc(collection(db, 'deposits'), {
                    userId: window.currentUser.uid,
                    amount,
                    method,
                    status: 'pending',
                    createdAt: serverTimestamp()
                });

                alert('تم إرسال طلب الإيداع بنجاح! سيتم مراجعته من قبل الإدارة.');
                closeModal('depositModal');
                form.reset();
            } catch (error) {
                console.error('Deposit error:', error);
                alert('حدث خطأ أثناء إرسال الطلب');
            }
        };

        // TICKETS
        window.createTicket = async function(event) {
            event.preventDefault();
            
            if (!window.currentUser) return;

            const form = event.target;
            const subject = form.querySelector('input[type="text"]').value;
            const message = form.querySelector('textarea').value;

            try {
                await addDoc(collection(db, 'tickets'), {
                    userId: window.currentUser.uid,
                    subject,
                    status: 'open',
                    messages: [{
                        from: window.currentUser.uid,
                        message,
                        timestamp: new Date().toISOString()
                    }],
                    createdAt: serverTimestamp()
                });

                alert('تم إرسال التذكرة بنجاح!');
                form.reset();
                switchTab('myTickets');
            } catch (error) {
                console.error('Create ticket error:', error);
                alert('حدث خطأ أثناء إرسال التذكرة');
            }
        };

        // LIVE CHAT
        window.openLiveChat = function() {
            if (!window.currentUser) {
                alert('يرجى تسجيل الدخول أولاً');
                showModal('loginModal');
                return;
            }

            showModal('liveChatModal');
            loadChatMessages();
        };

        function loadChatMessages() {
            const chatRef = collection(db, 'liveChat');
            const q = query(chatRef, where('userId', '==', window.currentUser.uid), orderBy('timestamp', 'asc'));
            
            onSnapshot(q, (snapshot) => {
                const messagesDiv = document.getElementById('chatMessages');
                messagesDiv.innerHTML = '';
                
                snapshot.forEach((doc) => {
                    const msg = doc.data();
                    const messageEl = document.createElement('div');
                    messageEl.style.marginBottom = '1rem';
                    messageEl.style.padding = '0.5rem';
                    messageEl.style.borderRadius = '8px';
                    messageEl.style.background = msg.isAdmin ? 'var(--bg-light)' : 'var(--primary)';
                    messageEl.style.color = msg.isAdmin ? 'var(--text-dark)' : 'white';
                    messageEl.textContent = msg.message;
                    messagesDiv.appendChild(messageEl);
                });

                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            });
        }

        window.sendChatMessage = async function(event) {
            event.preventDefault();
            
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            try {
                await addDoc(collection(db, 'liveChat'), {
                    userId: window.currentUser.uid,
                    message,
                    isAdmin: false,
                    timestamp: serverTimestamp()
                });

                input.value = '';
            } catch (error) {
                console.error('Send message error:', error);
            }
        };

        // ADMIN FUNCTIONS
        /* CALL updateOrderStatus() */
        window.updateOrderStatus = async function(orderId, newStatus) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                await updateDoc(doc(db, 'orders', orderId), {
                    status: newStatus,
                    updatedAt: serverTimestamp()
                });

                // Log action
                await addDoc(collection(db, 'adminLogs'), {
                    action: 'order_status_updated',
                    orderId,
                    newStatus,
                    adminId: window.currentUser.uid,
                    timestamp: serverTimestamp()
                });

                // Send notification to user
                const orderDoc = await getDoc(doc(db, 'orders', orderId));
                if (orderDoc.exists()) {
                    const order = orderDoc.data();
                    await sendNotification(order.userId, `تم تحديث حالة طلبك إلى: ${newStatus}`);
                }

                alert('تم تحديث حالة الطلب');
            } catch (error) {
                console.error('Update order status error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        /* CALL sendNotification() */
        async function sendNotification(userId, message) {
            const notificationRef = push(ref(rtdb, `notifications/${userId}`));
            await set(notificationRef, {
                message,
                read: false,
                timestamp: Date.now()
            });
        }

        /* CALL adminAdjustBalance() */
        window.adminAdjustBalance = async function(userId, amount) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                const balanceRef = ref(rtdb, `balances/${userId}`);
                const snapshot = await get(balanceRef);
                const currentBalance = snapshot.val() || 0;
                const newBalance = currentBalance + amount;

                await set(balanceRef, newBalance);

                // Log action
                await addDoc(collection(db, 'adminLogs'), {
                    action: 'balance_adjusted',
                    userId,
                    amount,
                    adminId: window.currentUser.uid,
                    timestamp: serverTimestamp()
                });

                await sendNotification(userId, `تم ${amount > 0 ? 'إضافة' : 'خصم'} ${Math.abs(amount)} من رصيدك`);

                alert('تم تعديل الرصيد بنجاح');
            } catch (error) {
                console.error('Adjust balance error:', error);
                alert('حدث خطأ أثناء تعديل الرصيد');
            }
        };

        /* CALL updateFakeStats() */
        window.updateFakeStats = async function() {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            const activeUsers = parseInt(document.getElementById('fakeActiveUsers').value);
            const completedOrders = parseInt(document.getElementById('fakeCompletedOrders').value);

            try {
                await set(ref(rtdb, 'stats/global'), {
                    activeUsers,
                    completedOrders,
                    satisfiedCustomers: 98
                });

                alert('تم تحديث الإحصائيات بنجاح');
                loadFakeStats();
            } catch (error) {
                console.error('Update stats error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        function loadFakeStats() {
            const statsRef = ref(rtdb, 'stats/global');
            onValue(statsRef, (snapshot) => {
                const stats = snapshot.val() || { activeUsers: 33000, completedOrders: 15420, satisfiedCustomers: 98 };
                document.getElementById('activeUsers').textContent = stats.activeUsers.toLocaleString();
                document.getElementById('completedOrders').textContent = stats.completedOrders.toLocaleString();
                document.getElementById('satisfiedCustomers').textContent = stats.satisfiedCustomers + '%';
            });
        }

        // ADMIN: ADD PRODUCT
        window.addProduct = async function(event) {
            event.preventDefault();
            
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            const form = event.target;
            const title = form.querySelector('input[type="text"]').value;
            const type = form.querySelectorAll('select')[0].value;
            const description = form.querySelector('textarea').value;
            const price = parseFloat(form.querySelector('input[type="number"]').value);
            const currency = form.querySelectorAll('select')[1].value;
            const stock = parseInt(form.querySelectorAll('input[type="number"]')[1].value);
            const imageUrl = form.querySelector('input[type="url"]').value;

            try {
                await addDoc(collection(db, 'products'), {
                    title,
                    type,
                    description,
                    price,
                    currency,
                    stock,
                    imageUrl,
                    visible: true,
                    adminFields: [],
                    createdAt: serverTimestamp()
                });

                alert('تم إضافة المنتج بنجاح');
                closeModal('addProductModal');
                form.reset();
            } catch (error) {
                console.error('Add product error:', error);
                alert('حدث خطأ أثناء إضافة المنتج');
            }
        };

        // ADMIN: ADD COUPON
        window.addCoupon = async function(event) {
            event.preventDefault();
            
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            const form = event.target;
            const code = form.querySelectorAll('input[type="text"]')[0].value;
            const discount = parseInt(form.querySelector('input[type="number"]').value);
            const expiryDate = form.querySelector('input[type="date"]').value;
            const maxUses = parseInt(form.querySelectorAll('input[type="number"]')[1].value);

            try {
                await addDoc(collection(db, 'coupons'), {
                    code,
                    discount,
                    expiryDate,
                    maxUses,
                    currentUses: 0,
                    active: true,
                    createdAt: serverTimestamp()
                });

                alert('تم إضافة الكوبون بنجاح');
                closeModal('addCouponModal');
                form.reset();
            } catch (error) {
                console.error('Add coupon error:', error);
                alert('حدث خطأ أثناء إضافة الكوبون');
            }
        };

        /* ADMIN: edit settings/site.texts */
        window.updateSiteSettings = async function() {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            const title = document.getElementById('siteTitle').value;
            const description = document.getElementById('siteDescription').value;

            try {
                await set(ref(rtdb, 'settings/site'), {
                    title,
                    description
                });

                alert('تم تحديث إعدادات الموقع بنجاح');
            } catch (error) {
                console.error('Update settings error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        window.exportLogs = async function() {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                const logsSnapshot = await getDocs(collection(db, 'adminLogs'));
                const logs = [];
                logsSnapshot.forEach((doc) => {
                    logs.push(doc.data());
                });

                const dataStr = JSON.stringify(logs, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'admin-logs.json';
                link.click();
            } catch (error) {
                console.error('Export logs error:', error);
                alert('حدث خطأ أثناء تصدير السجلات');
            }
        };

        // Initialize
        loadFakeStats();

        /* handleCryptoWebhook() + handleVodafoneCash() */
        // These would be HTTP endpoints handled by Firebase Functions or external service
        // Stub implementation for reference
        window.handleCryptoWebhook = function(data) {
            // Verify payment and update deposit status
            console.log('Crypto webhook received:', data);
        };

        window.handleVodafoneCash = function(data) {
            // Verify payment and update deposit status
            console.log('Vodafone Cash webhook received:', data);
        };
        
        function loadUserTickets() {
            if (!window.currentUser) return;
            
            const ticketsRef = collection(db, 'tickets');
            const q = query(ticketsRef, where('userId', '==', window.currentUser.uid), orderBy('createdAt', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                const ticketsList = document.getElementById('ticketsList');
                if (!ticketsList) return;
                
                if (snapshot.empty) {
                    ticketsList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا توجد تذاكر حالياً</p></div>';
                    return;
                }
                
                ticketsList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const ticket = doc.data();
                    const statusColors = {
                        'open': 'var(--success)',
                        'closed': 'var(--text-light)',
                        'pending': 'var(--warning)'
                    };
                    
                    const ticketCard = document.createElement('div');
                    ticketCard.className = 'card';
                    ticketCard.style.marginBottom = '1rem';
                    ticketCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <h3 style="margin: 0; color: var(--text-dark);">${ticket.subject}</h3>
                            <span class="badge" style="background: ${statusColors[ticket.status] || 'var(--text-light)'}; color: white;">${ticket.status}</span>
                        </div>
                        <p style="color: var(--text-light); margin: 0.5rem 0;">${ticket.messages && ticket.messages.length > 0 ? ticket.messages[0].message : ''}</p>
                        <small style="color: var(--text-light);">رقم التذكرة: ${doc.id}</small>
                    `;
                    ticketsList.appendChild(ticketCard);
                });
            });
        }

        function loadUserOrders() {
            if (!window.currentUser) return;
            
            const ordersRef = collection(db, 'orders');
            const q = query(ordersRef, where('userId', '==', window.currentUser.uid), orderBy('createdAt', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                const ordersList = document.getElementById('userOrders');
                if (!ordersList) return;
                
                if (snapshot.empty) {
                    ordersList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا توجد طلبات حالياً</p></div>';
                    return;
                }
                
                ordersList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const order = doc.data();
                    const statusColors = {
                        'pending': 'var(--warning)',
                        'processing': 'var(--primary)',
                        'completed': 'var(--success)',
                        'cancelled': 'var(--danger)'
                    };
                    
                    const orderCard = document.createElement('div');
                    orderCard.className = 'card';
                    orderCard.style.marginBottom = '1rem';
                    orderCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <h3 style="margin: 0; color: var(--text-dark);">${order.productTitle}</h3>
                            <span class="badge" style="background: ${statusColors[order.status] || 'var(--text-light)'}; color: white;">${order.status}</span>
                        </div>
                        <p style="color: var(--text-light); margin: 0.5rem 0;">السعر: ${order.price} ${order.currency}</p>
                        <p style="color: var(--text-light); margin: 0.5rem 0;">طريقة الدفع: ${order.paymentMethod}</p>
                        <small style="color: var(--text-light);">رقم الطلب: ${doc.id}</small>
                    `;
                    ordersList.appendChild(orderCard);
                });
            });
        }

        function loadAdminData() {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;
            
            loadAdminOrders();
            loadAdminDeposits();
            loadAdminUsers();
            loadAdminTickets();
            loadAdminCoupons();
            loadAdminLogs();
            loadAdminProducts();
        }

        function loadAdminOrders() {
            const ordersRef = collection(db, 'orders');
            const q = query(ordersRef, orderBy('createdAt', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                const ordersList = document.getElementById('adminOrdersList');
                if (!ordersList) return;
                
                if (snapshot.empty) {
                    ordersList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا توجد طلبات</p></div>';
                    return;
                }
                
                ordersList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const order = doc.data();
                    const orderCard = document.createElement('div');
                    orderCard.className = 'card';
                    orderCard.style.marginBottom = '1rem';
                    orderCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">${order.productTitle}</h3>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">المستخدم: ${order.userId}</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">السعر: ${order.price} ${order.currency}</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">طريقة الدفع: ${order.paymentMethod}</p>
                                ${order.orderDetails ? `<p style="color: var(--text-light); margin: 0.25rem 0;">التفاصيل: ${order.orderDetails}</p>` : ''}
                            </div>
                            <span class="badge">${order.status}</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="btn btn-sm btn-primary" onclick="updateOrderStatus('${doc.id}', 'processing')">قيد المعالجة</button>
                            <button class="btn btn-sm btn-success" onclick="updateOrderStatus('${doc.id}', 'completed')">مكتمل</button>
                            <button class="btn btn-sm btn-danger" onclick="updateOrderStatus('${doc.id}', 'cancelled')">ملغي</button>
                        </div>
                    `;
                    ordersList.appendChild(orderCard);
                });
            });
        }

        function loadAdminDeposits() {
            const depositsRef = collection(db, 'deposits');
            const q = query(depositsRef, orderBy('createdAt', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                const depositsList = document.getElementById('adminDepositsList');
                if (!depositsList) return;
                
                if (snapshot.empty) {
                    depositsList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا توجد طلبات إيداع</p></div>';
                    return;
                }
                
                depositsList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const deposit = doc.data();
                    const depositCard = document.createElement('div');
                    depositCard.className = 'card';
                    depositCard.style.marginBottom = '1rem';
                    depositCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">طلب إيداع</h3>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">المستخدم: ${deposit.userId}</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">المبلغ: ${deposit.amount}</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">الطريقة: ${deposit.method}</p>
                            </div>
                            <span class="badge">${deposit.status}</span>
                        </div>
                        ${deposit.status === 'pending' ? `
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-success" onclick="approveDeposit('${doc.id}', '${deposit.userId}', ${deposit.amount})">قبول</button>
                            <button class="btn btn-sm btn-danger" onclick="rejectDeposit('${doc.id}', '${deposit.userId}')">رفض</button>
                        </div>
                        ` : ''}
                    `;
                    depositsList.appendChild(depositCard);
                });
            });
        }

        window.approveDeposit = async function(depositId, userId, amount) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                // Update deposit status
                await updateDoc(doc(db, 'deposits', depositId), {
                    status: 'approved',
                    approvedAt: serverTimestamp()
                });

                // Add balance to user
                await adminAdjustBalance(userId, amount);

                alert('تم قبول الإيداع وإضافة الرصيد');
            } catch (error) {
                console.error('Approve deposit error:', error);
                alert('حدث خطأ أثناء قبول الإيداع');
            }
        };

        window.rejectDeposit = async function(depositId, userId) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                await updateDoc(doc(db, 'deposits', depositId), {
                    status: 'rejected',
                    rejectedAt: serverTimestamp()
                });

                await sendNotification(userId, 'تم رفض طلب الإيداع الخاص بك');

                alert('تم رفض الإيداع');
            } catch (error) {
                console.error('Reject deposit error:', error);
                alert('حدث خطأ أثناء رفض الإيداع');
            }
        };

        function loadAdminUsers() {
            const usersRef = collection(db, 'users');
            
            onSnapshot(usersRef, (snapshot) => {
                const usersList = document.getElementById('adminUsersList');
                if (!usersList) return;
                
                if (snapshot.empty) {
                    usersList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا يوجد مستخدمين</p></div>';
                    return;
                }
                
                usersList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const user = doc.data();
                    const userCard = document.createElement('div');
                    userCard.className = 'card';
                    userCard.style.marginBottom = '1rem';
                    userCard.innerHTML = `
                        <div style="margin-bottom: 1rem;">
                            <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">${user.displayName || 'مستخدم'}</h3>
                            <p style="color: var(--text-light); margin: 0.25rem 0;">البريد: ${user.email}</p>
                            <p style="color: var(--text-light); margin: 0.25rem 0;">الدور: ${user.role || 'user'}</p>
                            <p style="color: var(--text-light); margin: 0.25rem 0;">موثق: ${user.verified ? 'نعم' : 'لا'}</p>
                            <p style="color: var(--text-light); margin: 0.25rem 0;">محظور: ${user.banned ? 'نعم' : 'لا'}</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="btn btn-sm btn-primary" onclick="toggleUserVerification('${doc.id}', ${!user.verified})">
                                ${user.verified ? 'إلغاء التوثيق' : 'توثيق'}
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="toggleUserBan('${doc.id}', ${!user.banned})">
                                ${user.banned ? 'إلغاء الحظر' : 'حظر'}
                            </button>
                            <button class="btn btn-sm btn-success" onclick="promptAdjustBalance('${doc.id}')">تعديل الرصيد</button>
                        </div>
                    `;
                    usersList.appendChild(userCard);
                });
            });
        }

        window.toggleUserVerification = async function(userId, verified) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                await updateDoc(doc(db, 'users', userId), {
                    verified: verified
                });

                await sendNotification(userId, verified ? 'تم توثيق حسابك' : 'تم إلغاء توثيق حسابك');

                alert('تم تحديث حالة التوثيق');
            } catch (error) {
                console.error('Toggle verification error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        window.toggleUserBan = async function(userId, banned) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                await updateDoc(doc(db, 'users', userId), {
                    banned: banned
                });

                await sendNotification(userId, banned ? 'تم حظر حسابك' : 'تم إلغاء حظر حسابك');

                alert('تم تحديث حالة الحظر');
            } catch (error) {
                console.error('Toggle ban error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        window.promptAdjustBalance = function(userId) {
            const amount = parseFloat(prompt('أدخل المبلغ (استخدم - للخصم):'));
            if (isNaN(amount)) {
                alert('المبلغ غير صحيح');
                return;
            }
            adminAdjustBalance(userId, amount);
        };

        function loadAdminTickets() {
            const ticketsRef = collection(db, 'tickets');
            const q = query(ticketsRef, orderBy('createdAt', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                const ticketsList = document.getElementById('adminTicketsList');
                if (!ticketsList) return;
                
                if (snapshot.empty) {
                    ticketsList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا توجد تذاكر</p></div>';
                    return;
                }
                
                ticketsList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const ticket = doc.data();
                    const ticketCard = document.createElement('div');
                    ticketCard.className = 'card';
                    ticketCard.style.marginBottom = '1rem';
                    ticketCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">${ticket.subject}</h3>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">المستخدم: ${ticket.userId}</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">${ticket.messages && ticket.messages.length > 0 ? ticket.messages[0].message : ''}</p>
                            </div>
                            <span class="badge">${ticket.status}</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-success" onclick="updateTicketStatus('${doc.id}', 'closed')">إغلاق</button>
                            <button class="btn btn-sm btn-primary" onclick="updateTicketStatus('${doc.id}', 'open')">فتح</button>
                        </div>
                    `;
                    ticketsList.appendChild(ticketCard);
                });
            });
        }

        window.updateTicketStatus = async function(ticketId, status) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                await updateDoc(doc(db, 'tickets', ticketId), {
                    status: status
                });

                const ticketDoc = await getDoc(doc(db, 'tickets', ticketId));
                if (ticketDoc.exists()) {
                    const ticket = ticketDoc.data();
                    await sendNotification(ticket.userId, `تم تحديث حالة تذكرتك إلى: ${status}`);
                }

                alert('تم تحديث حالة التذكرة');
            } catch (error) {
                console.error('Update ticket status error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        function loadAdminCoupons() {
            const couponsRef = collection(db, 'coupons');
            
            onSnapshot(couponsRef, (snapshot) => {
                const couponsList = document.getElementById('adminCouponsList');
                if (!couponsList) return;
                
                if (snapshot.empty) {
                    couponsList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا توجد كوبونات</p></div>';
                    return;
                }
                
                couponsList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const coupon = doc.data();
                    const couponCard = document.createElement('div');
                    couponCard.className = 'card';
                    couponCard.style.marginBottom = '1rem';
                    couponCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">${coupon.code}</h3>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">الخصم: ${coupon.discount}%</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">الاستخدامات: ${coupon.currentUses || 0} / ${coupon.maxUses}</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">تاريخ الانتهاء: ${coupon.expiryDate}</p>
                            </div>
                            <span class="badge">${coupon.active ? 'نشط' : 'غير نشط'}</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-primary" onclick="toggleCouponStatus('${doc.id}', ${!coupon.active})">
                                ${coupon.active ? 'تعطيل' : 'تفعيل'}
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCoupon('${doc.id}')">حذف</button>
                        </div>
                    `;
                    couponsList.appendChild(couponCard);
                });
            });
        }

        window.toggleCouponStatus = async function(couponId, active) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                await updateDoc(doc(db, 'coupons', couponId), {
                    active: active
                });

                alert('تم تحديث حالة الكوبون');
            } catch (error) {
                console.error('Toggle coupon error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        window.deleteCoupon = async function(couponId) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            if (!confirm('هل أنت متأكد من حذف هذا الكوبون؟')) return;

            try {
                await deleteDoc(doc(db, 'coupons', couponId));
                alert('تم حذف الكوبون');
            } catch (error) {
                console.error('Delete coupon error:', error);
                alert('حدث خطأ أثناء الحذف');
            }
        };

        function loadAdminLogs() {
            const logsRef = collection(db, 'adminLogs');
            const q = query(logsRef, orderBy('timestamp', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                const logsList = document.getElementById('adminLogsList');
                if (!logsList) return;
                
                if (snapshot.empty) {
                    logsList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا توجد سجلات</p></div>';
                    return;
                }
                
                logsList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const log = doc.data();
                    const logCard = document.createElement('div');
                    logCard.className = 'card';
                    logCard.style.marginBottom = '0.5rem';
                    logCard.style.padding = '0.75rem';
                    logCard.innerHTML = `
                        <p style="margin: 0; color: var(--text-dark);"><strong>${log.action}</strong></p>
                        <p style="margin: 0.25rem 0 0 0; color: var(--text-light); font-size: 0.875rem;">
                            ${log.userId ? `المستخدم: ${log.userId}` : ''} 
                            ${log.adminId ? `| المشرف: ${log.adminId}` : ''}
                        </p>
                    `;
                    logsList.appendChild(logCard);
                });
            });
        }

        function loadAdminProducts() {
            const productsRef = collection(db, 'products');
            
            onSnapshot(productsRef, (snapshot) => {
                const productsList = document.getElementById('adminProductsList');
                if (!productsList) return;
                
                if (snapshot.empty) {
                    productsList.innerHTML = '<div class="card"><p style="text-align: center; color: var(--text-light);">لا توجد منتجات</p></div>';
                    return;
                }
                
                productsList.innerHTML = '';
                snapshot.forEach((doc) => {
                    const product = doc.data();
                    const productCard = document.createElement('div');
                    productCard.className = 'card';
                    productCard.style.marginBottom = '1rem';
                    productCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">${product.title}</h3>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">النوع: ${product.type}</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">السعر: ${product.price} ${product.currency}</p>
                                <p style="color: var(--text-light); margin: 0.25rem 0;">المخزون: ${product.stock}</p>
                            </div>
                            <span class="badge">${product.visible ? 'ظاهر' : 'مخفي'}</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-primary" onclick="toggleProductVisibility('${doc.id}', ${!product.visible})">
                                ${product.visible ? 'إخفاء' : 'إظهار'}
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct('${doc.id}')">حذف</button>
                        </div>
                    `;
                    productsList.appendChild(productCard);
                });
            });
        }

        window.toggleProductVisibility = async function(productId, visible) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            try {
                await updateDoc(doc(db, 'products', productId), {
                    visible: visible
                });

                alert('تم تحديث حالة المنتج');
            } catch (error) {
                console.error('Toggle product visibility error:', error);
                alert('حدث خطأ أثناء التحديث');
            }
        };

        window.deleteProduct = async function(productId) {
            if (!window.currentUserData || window.currentUserData.role !== 'admin') return;

            if (!confirm('هل أنت متأكد من حذف هذا المنتج؟')) return;

            try {
                await deleteDoc(doc(db, 'products', productId));
                alert('تم حذف المنتج');
            } catch (error) {
                console.error('Delete product error:', error);
                alert('حدث خطأ أثناء الحذف');
            }
        };
    </script>

    <script>
        // UI FUNCTIONS
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show selected section
            const sectionMap = {
                'home': 'homeSection',
                'smm': 'smmSection',
                'real-products': 'realProductsSection',
                'digital-products': 'digitalProductsSection',
                'website-design': 'websiteDesignSection',
                'offers': 'offersSection',
                'support': 'supportSection',
                'profile': 'profileSection',
                'settings': 'profileSection',
                'admin': 'adminSection'
            };

            const sectionId = sectionMap[sectionName];
            if (sectionId) {
                document.getElementById(sectionId).classList.remove('hidden');
            }

            // Close profile menu if open
            document.getElementById('profileMenu').classList.remove('show');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            
            const icon = document.getElementById('themeIcon');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function toggleProfileMenu() {
            document.getElementById('profileMenu').classList.toggle('show');
        }

        function toggleNotifications() {
            alert('عرض الإشعارات - قيد التطوير');
        }

        function changeCurrency() {
            window.currentCurrency = document.getElementById('currencySelector').value;
            // Reload balance display
            if (window.currentUser) {
                const balanceRef = window.firebaseModules.ref(window.firebaseRtdb, `balances/${window.currentUser.uid}`);
                window.firebaseModules.get(balanceRef).then((snapshot) => {
                    const balance = snapshot.val() || 0;
                    document.getElementById('balanceDisplay').textContent = `${balance.toFixed(2)} ${window.currentCurrency}`;
                });
            }
        }

        function showUserInterface() {
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userActions').classList.remove('hidden');
        }

        function showAuthInterface() {
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userActions').classList.add('hidden');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.admin-content .tab-content').forEach(content => {
                content.classList.remove('active');
            });

            event.target.classList.add('active');
            document.getElementById('admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab').classList.add('active');
            
            switch(tabName) {
                case 'orders':
                    loadAdminOrders();
                    break;
                case 'deposits':
                    loadAdminDeposits();
                    break;
                case 'users':
                    loadAdminUsers();
                    break;
                case 'tickets':
                    loadAdminTickets();
                    break;
                case 'coupons':
                    loadAdminCoupons();
                    break;
                case 'logs':
                    loadAdminLogs();
                    break;
                case 'products':
                    loadAdminProducts();
                    break;
            }
        }

        function submitWebsiteDesign(event) {
            event.preventDefault();
            alert('تم إرسال طلب تصميم الموقع بنجاح! سنتواصل معك قريباً.');
            event.target.reset();
        }

        // Close modals when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        });

        // Close profile menu when clicking outside
        document.addEventListener('click', (event) => {
            const profileDropdown = document.querySelector('.profile-dropdown');
            if (profileDropdown && !profileDropdown.contains(event.target)) {
                document.getElementById('profileMenu').classList.remove('show');
            }
        });
    </script>
</body>
</html>
