
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="page_title">KOKO ProLab</title>
    <style>
        :root {
            --primary-color: #3d5afe;
            --primary-dark: #0031ca;
            --secondary-color: #ff4081;
            --background-light: #f5f7fa;
            --background-dark: #121212;
            --surface-light: #ffffff;
            --surface-dark: #1e1e1e;
            --text-light: #212121;
            --text-dark: #e0e0e0;
            --border-color-light: #e0e0e0;
            --border-color-dark: #333;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-family-rtl: 'Tahoma', sans-serif;
        }

        html[data-theme="dark"] {
            --background: var(--background-dark);
            --surface: var(--surface-dark);
            --text: var(--text-dark);
            --border-color: var(--border-color-dark);
        }

        html[data-theme="light"] {
            --background: var(--background-light);
            --surface: var(--surface-light);
            --text: var(--text-light);
            --border-color: var(--border-color-light);
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background);
            color: var(--text);
            margin: 0;
            padding-top: 80px;
            transition: background-color 0.3s, color 0.3s;
        }
        
        html[dir="rtl"] body {
            font-family: var(--font-family-rtl);
        }

        header {
            position: fixed; top: 0; left: 0; right: 0; display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 2rem; background-color: var(--surface); box-shadow: 0 2px 10px var(--shadow-color); z-index: 1000;
        }
        
        .header-left, .header-right { display: flex; align-items: center; gap: 1rem; }
        .logo { font-weight: bold; font-size: 1.5rem; color: var(--primary-color); }
        .user-status { display: flex; align-items: center; gap: 1rem; }
        .user-info { font-weight: 600; }
        .icon-btn { background: none; border: none; cursor: pointer; font-size: 1.5rem; color: var(--text); }
        .btn {
            padding: 0.6rem 1.2rem; border: none; border-radius: var(--border-radius); font-weight: 600; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-secondary { background-color: var(--secondary-color); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px var(--shadow-color); }

        main { padding: 2rem; max-width: 1200px; margin: 0 auto; }
        h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        .service-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .service-card { background-color: var(--surface); border-radius: var(--border-radius); box-shadow: 0 4px 12px var(--shadow-color); padding: 1.5rem; display: flex; flex-direction: column; transition: transform 0.3s, box-shadow 0.3s; }
        .service-card:hover { transform: translateY(-5px); }
        .service-card .price { font-size: 1.2rem; font-weight: bold; color: var(--primary-color); margin: 1rem 0; }
        .service-card .btn { margin-top: auto; }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal.active { display: flex; }
        .modal-backdrop { position: absolute; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(8px); }
        .modal-content { position: relative; background: var(--surface); padding: 2rem; border-radius: var(--border-radius); width: 90%; max-width: 500px; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input, .form-group textarea { width: 100%; padding: 0.8rem; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; background: var(--background); color: var(--text); }
        .error-message { color: var(--secondary-color); margin-top: 10px; }
        .tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 1.5rem; }
        .tab { padding: 1rem; cursor: pointer; font-weight: 600; }
        .tab.active { border-bottom: 2px solid var(--primary-color); }
        .form-content { display: none; } .form-content.active { display: block; }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <div class="logo">KOKO ProLab</div>
        </div>
        <div class="header-right">
            <div id="user-status-container" class="user-status"></div>
            <button id="theme-toggle" class="icon-btn">ðŸŒ™</button>
            <button id="lang-toggle" class="icon-btn">AR</button>
        </div>
    </header>

    <main>
        <section id="categories">
            <h2 data-lang-key="categories_heading">Categories</h2>
            <div id="category-list" class="category-list"></div>
        </section>
        <section id="services">
            <h2 data-lang-key="services_heading">Services</h2>
            <div id="service-grid" class="service-grid"></div>
        </section>
        <section id="active-orders">
            <h2 data-lang-key="orders_heading">Your Orders</h2>
            <div id="orders-list"><p data-lang-key="login_to_see_orders">Login to see your orders.</p></div>
        </section>
    </main>

    <!-- modals and Firebase script -->
    <div id="auth-modal" class="modal"><div class="modal-backdrop"></div><div class="modal-content"><div class="tabs"><div class="tab active" data-tab="login" data-lang-key="login">Login</div><div class="tab" data-tab="signup" data-lang-key="signup">Sign Up</div></div><div id="login-form" class="form-content active"><div class="form-group"><label for="login-email" data-lang-key="email">Email</label><input type="email" id="login-email"></div><div class="form-group"><label for="login-password" data-lang-key="password">Password</label><input type="password" id="login-password"></div><button id="login-btn" class="btn btn-primary" data-lang-key="login">Login</button><p id="login-error" class="error-message"></p><hr><button id="google-signin-btn" class="btn" style="width:100%;background:#4285F4;color:white;" data-lang-key="google_signin">Sign in with Google</button></div><div id="signup-form" class="form-content"><div class="form-group"><label for="signup-username" data-lang-key="username">Username</label><input type="text" id="signup-username"></div><div class="form-group"><label for="signup-email" data-lang-key="email">Email</label><input type="email" id="signup-email"></div><div class="form-group"><label for="signup-password" data-lang-key="password">Password</label><input type="password" id="signup-password"></div><button id="signup-btn" class="btn btn-primary" data-lang-key="signup">Sign Up</button><p id="signup-error" class="error-message"></p></div></div></div>
    <div id="order-modal" class="modal"><div class="modal-backdrop"></div><div class="modal-content"><h3 data-lang-key="place_order">Place Your Order</h3><h4 id="order-service-name"></h4><form id="order-form"><input type="hidden" id="order-service-id"><div class="form-group"><label for="order-target-link" data-lang-key="target_link">Target Link</label><input type="text" id="order-target-link" required></div><div class="form-group"><label for="order-quantity" data-lang-key="quantity">Quantity</label><input type="number" id="order-quantity" required min="1"></div><button type="submit" class="btn btn-primary" data-lang-key="submit_order">Submit Order</button><p id="order-error" class="error-message"></p></form></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
        const firebaseConfig = { apiKey: "AIzaSyDUaSnYinH910wp3zDHOCNuqWp9QjwIRow", authDomain: "koko-prolab.firebaseapp.com", projectId: "koko-prolab" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        const translations = {
            en: { page_title: "KOKO ProLab", categories_heading: "Categories", services_heading: "Services", orders_heading: "Your Orders", login_to_see_orders: "Login to see your orders.", login: "Login", signup: "Sign Up", email: "Email", password: "Password", google_signin: "Sign in with Google", username: "Username", place_order: "Place Your Order", target_link: "Target Link (or ID)", quantity: "Quantity", submit_order: "Submit Order", hi: "Hi", profile: "Profile", logout: "Logout", login_signup: "Login / Sign Up", order_now: "Order Now" },
            ar: { page_title: "ÙƒÙˆÙƒÙˆ Ø¨Ø±Ùˆ Ù„Ø§Ø¨", categories_heading: "Ø§Ù„ÙØ¦Ø§Øª", services_heading: "Ø§Ù„Ø®Ø¯Ù…Ø§Øª", orders_heading: "Ø·Ù„Ø¨Ø§ØªÙƒ", login_to_see_orders: "Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø±Ø¤ÙŠØ© Ø·Ù„Ø¨Ø§ØªÙƒ.", login: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„", signup: "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨", email: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", password: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", google_signin: "Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„", username: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", place_order: "Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨", target_link: "Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù", quantity: "Ø§Ù„ÙƒÙ…ÙŠØ©", submit_order: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨", hi: "Ù…Ø±Ø­Ø¨Ø§Ù‹", profile: "Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ", logout: "Ø§Ù„Ø®Ø±ÙˆØ¬", login_signup: "Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„", order_now: "Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†" }
        };

        document.addEventListener('DOMContentLoaded', () => {
            // --- THEME & LANGUAGE --- //
            const themeToggle = document.getElementById('theme-toggle');
            const langToggle = document.getElementById('lang-toggle');
            const htmlEl = document.documentElement;

            const applyTheme = (theme) => {
                htmlEl.setAttribute('data-theme', theme);
                themeToggle.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
                localStorage.setItem('theme', theme);
            };

            const applyLanguage = (lang) => {
                htmlEl.lang = lang;
                htmlEl.dir = lang === 'ar' ? 'rtl' : 'ltr';
                langToggle.textContent = lang === 'ar' ? 'EN' : 'AR';
                localStorage.setItem('language', lang);
                document.querySelectorAll('[data-lang-key]').forEach(el => {
                    const key = el.getAttribute('data-lang-key');
                    el.textContent = translations[lang][key] || el.textContent;
                });
            };

            themeToggle.addEventListener('click', () => {
                const newTheme = htmlEl.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
            });

            langToggle.addEventListener('click', () => {
                const newLang = htmlEl.lang === 'ar' ? 'en' : 'ar';
                applyLanguage(newLang);
                renderServices(); // Re-render services to apply language change to buttons
            });
            
            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const savedLang = localStorage.getItem('language') || 'en';
            applyTheme(savedTheme);
            applyLanguage(savedLang);

            // --- AUTH & UI --- //
            auth.onAuthStateChanged(user => {
                const userStatusContainer = document.getElementById('user-status-container');
                if (user) {
                    db.collection('users').doc(user.uid).get().then(doc => {
                        const userData = doc.exists ? doc.data() : {};
                        const name = userData.displayName || user.displayName || userData.username;
                        userStatusContainer.innerHTML = `
                            <div class="user-info">${translations[htmlEl.lang].hi}, ${name}</div>
                            <a href="profile.html" class="btn btn-primary" data-lang-key="profile">${translations[htmlEl.lang].profile}</a>
                            <button id="logout-btn" class="btn btn-secondary" data-lang-key="logout">${translations[htmlEl.lang].logout}</button>
                        `;
                        document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
                    });
                    document.getElementById('auth-modal').classList.remove('active');
                    loadUserOrders(user.uid);
                } else {
                    userStatusContainer.innerHTML = `<button id="login-modal-btn" class="btn btn-primary" data-lang-key="login_signup">${translations[htmlEl.lang].login_signup}</button>`;
                    document.getElementById('login-modal-btn').addEventListener('click', () => document.getElementById('auth-modal').classList.add('active'));
                    document.getElementById('orders-list').innerHTML = `<p data-lang-key="login_to_see_orders">${translations[htmlEl.lang].login_to_see_orders}</p>`;
                }
            });
            
            // Render services and categories
            const serviceGrid = document.getElementById('service-grid');
            const categoryList = document.getElementById('category-list');
            const renderServices = async () => {
                const serviceSnap = await db.collection('services').get();
                serviceGrid.innerHTML = '';
                const categories = new Set();
                serviceSnap.forEach(doc => {
                    const service = doc.data();
                    categories.add(service.category);
                    const card = document.createElement('div');
                    card.className = 'service-card';
                    card.innerHTML = `<h3>${service.name}</h3><p>${service.description}</p><div class="price">$${service.price}</div><button class="btn btn-primary order-btn" data-service-id="${doc.id}" data-service-name="${service.name}" data-lang-key="order_now">${translations[htmlEl.lang].order_now}</button>`;
                    serviceGrid.appendChild(card);
                });
                categoryList.innerHTML = '';
                categories.forEach(cat => {
                    categoryList.innerHTML += `<button class="btn btn-secondary">${cat}</button>`;
                });
            };
            renderServices();
            
            // Other functions (modal handling, auth actions, ordering) remain largely the same, just ensure text is updated on language change.
             const loadUserOrders = (uid) => { /* ... logic to load and display user orders ... */ };
            // Add event listeners for new elements inside other functions as needed.
        });
    </script>
</body>
</html>
